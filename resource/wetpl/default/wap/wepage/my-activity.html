<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" id="favicon" href="" />
    <!--<link rel="stylesheet" href="{{PATH_TML}}article/css/article.css">-->
    <link rel="stylesheet" href="css/wepage.css"/>
    <script src="js/browser.min.js"></script>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/vue.min.js"></script>
    <!--<script charset="utf-8" type="text/javascript" src="{{PATH_CONFIG}}"></script>-->
    <!--<script src="js/wepage.js"></script>-->
    <title></title>
</head>
<body>
    <div id="app">
        <div id="title">
            <img id="goback" src="img/back.svg" width="18" />
            <p>{{title}}</p>
            <img id="user" src="img/user.svg" width="20" />
        </div>
        <div class="blank"></div>
        <div id="content">
            <div class="part">
                <div class="date"><span>{{single_data.created_at}}</span></div>
                <div class="article">
                    <div class="art-title">{{single_data.title}}</div>
                    <div class="art-date">{{single_data.created_at.substr(0, 10)}}</div>
                    <div class="art-cover" :style="{'background-image': 'url(' + single_data.cover + ')', 'background-size': '100% 100%'}"></div>
                    <div class="art-summary" v-html="single_data.summary"></div>
                    <div class="art-read"><a >查看全文</a></div>
                </div>
            </div>

            <div class="part">
                <div class="date"><span>{{car_data.created_at}}</span></div>
                <div class="art-list">
                    <div class="cover" :style="{'background-image': 'url(' + car_data.cover + ')', 'background-size': '100% 100%'}"></div>
                    <div class="title"><span>{{car_data.title}}</span></div>
                    <div class="lists" v-for="list in cdr_data">
                        <div class="list-title">{{list.title}}</div>
                        <div class="list-cover" :style="{'background-image': 'url(' + list.cover + ')', 'background-size': '100%'}"></div>
                        <!--<img class="list-cover" src="img/cover.png" />-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var single = function(list){
            var cover = '';
            if (list[0].cover != '') {
                cover = list[0].cover;
            } else {
                cover = 'img/cover.png';
            }
            var template = `
                <div class="part">
                    <div class="date"><span>` + list[0].created_at + `</span></div>
                <div class="article">
                    <div class="art-title">` + list[0].title + `</div>
                <div class="art-date">` + list[0].created_at.substr(0, 10) + `</div>
                <div class="art-cover">
                    <img class="list-cover" src="` + cover + `" style="width: 100%; height: 100%;"/>
                </div>
                    <div class="art-summary">` + list[0].summary.substr(0,50) + `</div>
                    <div class="art-read"><a href="">查看全文</a></div>
                </div>
                </div>`;
            return template;
        }

        var multiBody = function(list){
            var template = `
            <div class="lists">
                <div class="list-title">` + list.title + `</div>
                <img class="list-cover" src="` + list.cover + `" />
            </div>`;
            return template;
        }

        var multiHead = function(list){
            let res = [];
            for (var i = 1; i < list.length; i++) {
                res.push(list[i]);
            }
            var template = `
            <div class="part">
                <div class="date"><span>` + list[0].created_at + `</span></div>
            <div class="art-list">
                <div class="cover">
                    <img class="list-cover" src="` + list[0].cover + `" style="width: 100%; height: 100%;"/>
                </div>
                <div class="title"><span>` + list[0].title + `</span></div>
                ` + res.map(x => multiBody(x)).join('') + `
            </div>
            </div>`;
            return template;
        }

        var oneDay = (item, list) => {
            return list.filter(x => x.created_at.substr(0, 10) == item.created_at.substr(0, 10));
        }

        var remove = (item, list) => {
            return list.filter(x => x.created_at.substr(0, 10) != item.created_at.substr(0, 10));
        }

        var genTpl = (list) => {
            var ls = oneDay(list[0], list);
            if (list == '') {
                return ;
            }
            if (ls.length == 1) {
                $("#content").append(single(ls));
            } else {
                $("#content").append(multiHead(ls));
            }
            return genTpl(remove(list[0], list));
        }

        var artLists = function(ref, id){
            $.ajax({
                url: 'http://new.wezchina.com/api/articles/list' + '?userId=' + id,
                type: 'GET',
                success: function(data) {
                    console.log(data);
                    if (data.code == 200) {
                        var list = data.data.list;
                        //var len = data.data.list.length;
                        genTpl(list);
                        /*ref.single_data = list[0];
                        console.log(ref.single_data)
                        if (len == 0) {
                            return ;
                        }
                        if (len > 1) {
                            ref.car_data = list[0];
                            for (var i = 1; i< len; i++) {
                                ref.cdr_data.push(list[i]);
                            }
                        } else {
                            ref.single_data = list[0];
                        }*/
                    }
                }
            })
        }
        new Vue({
            el: '#app',
            data: {
                title: 'Ta的微主页',
                car_data: '',
                cdr_data: [],
                single_data: ''
            },
            created: function() {
                var _self = this;
                artLists(_self, '11e41d20-72ad-11e7-8825-933924ec5999');
            },
            methods: {

            }
        })
    </script>
</body>
</html>
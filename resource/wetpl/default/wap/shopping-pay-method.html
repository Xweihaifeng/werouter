<#extend#>public/domain/domain_extend.html</#extend#>
<script type="text/javascript">
    show.header = 'no';
    show.footer = 'no';
</script>
<link rel="stylesheet" type="text/css" href="{{PATH_TML}}css/shopping-pay-method.css" />
<!-- 支付方式头部开始 -->
<header class="pay_header">
    <nav class="pay_nav">
        <a href="javascript:void(0)" onclick="javascript:history.back(-1)">
            <li class="pay_icon_img pay_icon_img_clear"></li>
        </a>
        <a href="javascript:void(0)"><li class="pay_nav_title"> 支付方式 </li></a>
        <a href="javascript:void(0)"></a>
    </nav>
</header>
<!-- 支付方式头部结束 -->

<!-- 支付方式内容开始 -->
<section class="pay_section" id="pay_section">
	<slide class="pay_order background">
		<slide class="pay_order_img"></slide>
		<slide class="pay_order_info">
			<li> 订单号：{{order_detail.order_num}} </li>
			<li> 网上支付订单等待支付 </li>
			<li> 您共需支付：<em>￥</em><span>{{order_detail.order_price}}</span> </li>
		</slide>
	</slide>
	<slide class="pay_wechat">
		<slide class="pay_wechat_img background"></slide>
		<slide class="pay_wechat_title"> 微信支付 <span class="pay_recommend"> 推荐 </span> </slide>
		<slide class="pay_wechat_select pay_select"></slide>
	</slide>
	<slide class="pay_immediately">
		<a href="javascript:void(0)" @click="order_pay"> 立即支付 </a>
	</slide>
</section>

<script>
    // 创建vue根实例
    new Vue({
        el: "#app",
        data: {
            store_num       : '',
            order_detail    : {},
            openid          : ''
        },
        mounted: function() 
        {
            $app.set_title('订单支付');
            this.$nextTick(()=>{
                this.store_num = $app.get_query_string('store_num');
                this.openid = $app.get_cookie('openid');
                ajax.get('order/detail/' + this.store_num).then((res)=>{
                    this.order_detail = res.data;
                });
            });
        },
        methods:{
            order_pay() 
            {
                var wxpay = { 'order_id' : this.store_num , 'openid' : this.openid};
                ajax.post('pages/wechatPay/mallOrderPhonePay' , wxpay).then((res)=>{
                    
                    if(res.code == 200)
                    {
                        alert(res.data.config.timeStamp);
                        $wx.pay(res.data.config , function(wx_res){
                            mb_message('支付成功');
                        });
                    }
                    else
                    {
                        mb_message('订单异常无法支付');
                    }

                });
            }
        }
    })
</script>

<#extend#>public/domain/domain_extend.html</#extend#>
<script type="text/javascript">
    show.header = 'no';
    show.footer = 'no';
</script>
<link rel="stylesheet" type="text/css" href="{{PATH_TML}}shopping/css/base.css">
<link rel="stylesheet" type="text/css" href="{{PATH_TML}}shopping/css/nctouch_common.css">
<link rel="stylesheet" type="text/css" href="{{PATH_TML}}shopping/css/nctouch_cart.css">
<style type="text/css">
    .nctouch-main-layout {
        margin-top: 0;
    }

    .rate-money {
        font-size: 0.6rem;
        padding: 0.5rem;
        background: white;
    }

    .rate-money span {
        float: right;
        margin-right: 0.5rem;
        color: #7a232e;
    }

    ul * {
        vertical-align: middle;
        font-size: 14px;
        line-height: 1;
    }

    ul img {
        width: 18px;
        height: 18px;
    }

    ul li {
        padding: 10px 15px 10px;
    }

    ul li > span:last-child {
        float: right;
        width: 18px;
        height: 18px;
        background-image: url("../../images/buy_step1/jump.png");
        background-repeat: no-repeat;
        background-size: 100% 100%;
    }

    .other {
        background-image: url("../../images/buy_step1/join.png") !important;
        background-size: 100% 100%;
    }

    #ksy {
        font: 15px !important;
    }

    .cancelImg {
        width: 18px;
        height: 18px;

    }

    .redTitle {
        text-align: center;
        text-align: -webkit-center;
        position: fixed;
        width: 100%;
        height: 50px;
        background-color: white;
    }

    .sure {
        height: 45px;
        background-color: #7A232E;

        color: white;
        text-align: center;
        text-align: -webkit-center;
    }

    .sure span {
        font-size: 15px;
        vertical-align: bottom;
    }

    .receive {
        overflow: scroll;
    }

    .lisheng {
        font-size: 13px;
        color: #F25B4B;
        margin-left: 10px;
    }

    .ding {
        position: absolute;
        z-index: 9;
        font-size: 0px;
        /*left: 0.38181818rem;*/
        margin-top: 0.381818rem;

    }

    .manzeng {
        font-size: 11px;
        background-color: #F25B4B;
        color: white;
        border-radius: 10%;
        /* width: 1.3rem; */
        /* line-height: 1; */
        text-align: center;
        text-align: -webkit-center;
        vertical-align: middle;
        top: 0.9rem;
        z-index: 999;
        margin-left: 0.3rem;
        padding: 0.1rem;
        float: left;
    }

    .manzengLeft {
        left: 1.8rem;
    }
</style>
</head>
<body>

<div class="nctouch-main-layout mb20">
    <div class="nctouch-cart-block">
        <!--正在使用的默认地址Begin-->
        <div class="nctouch-cart-add-default"><a href="javascript:void(0);" id="list-address-valve"><i
                class="icon-add"></i>
            <dl @click="add_address">
                <input type="hidden" class="inp" name="address_id" id="address_id" value="249068">
                <dt>收货人：<span id="true_name">{{order_address_default.name}}</span><span id="mob_phone">{{order_address_default.telophone}}</span></dt>
                <dd>收货地址：<span id="address">{{order_address_default.province_name}} {{order_address_default.area_name}} {{order_address_default.detail}}</span></dd>
            </dl>
            <i class="icon-arrow"></i></a></div>
        <!--正在使用的默认地址End-->
    </div>

    <!--选择收货地址Begin-->
    <div id = "select_address" class="hide">
        <div class="nctouch-main-layout"
             style="display: block; position: absolute; top: 2rem; right: 0; left: 0; bottom:4.6rem; overflow: scroll; z-index: 1;"
             id="list-address-scroll">
            <ul class="nctouch-cart-add-list" id="list-address-add-list-ul"
                style="transition-timing-function: cubic-bezier(0.1, 0.57, 0.1, 1); transition-duration: 0ms; transform: translate(0px, 0px) translateZ(0px);">
                <li class="selected" v-for="item in order_address_list"> 
                    <i></i>
                    <dl>
                        <dt>收货人：<span id="">{{item.name}}</span><span>{{item.telophone}}</span><sub v-if="item.status == 1">默认</sub>
                        </dt>
                        <dd><span id="">{{order_address_default.province_name}} {{order_address_default.area_name}} {{order_address_default.detail}}</span>
                        </dd>
                    </dl>
                </li>
            </ul>
        </div>
        <div id="addresslist" class="mt10" style="position: absolute; right: 0; left: 0; bottom: 0; z-index: 1;"><a
                href="javascript:void(0);" class="btn-l" id="new-address-valve"
                style="font-size: .72727273rem;background: none;border: 1px solid #7A232E;">+ 添加地址</a></div>
    </div>
    <!--选择收货地址End-->
    <!--新增收货地址Begin-->
    <div id="new-address-wrapper" class="nctouch-full-mask hide">
        <div class="nctouch-full-mask-bg"></div>
        <div class="nctouch-full-mask-block">
            <div class="header" style="display:none;">
                <div class="header-wrap">
                    <div class="header-l"><a href="javascript:void(0);"> <i class="back"></i> </a></div>
                    <div class="header-title">
                        <h1>新增收货地址</h1>
                    </div>
                </div>
            </div>
            <div class="nctouch-main-layout" id="new-address-scroll">
                <div class="nctouch-inp-con">
                    <form id="add_address_form">
                        <ul class="form-box">
                            <li class="form-item">
                                <h4>姓名</h4>

                                <div class="input-box">
                                    <input type="text" class="inp" name="true_name" id="vtrue_name" autocomplete="off"
                                           oninput="writeClear($(this));" placeholder="收货人姓名">
                                    <span class="input-del"></span></div>
                            </li>
                            <li class="form-item">
                                <h4>联系手机</h4>

                                <div class="input-box">
                                    <input type="tel" class="inp" name="mob_phone" id="vmob_phone" autocomplete="off"
                                           oninput="writeClear($(this));" maxlength="11" placeholder="11位手机号">
                                    <span class="input-del"></span></div>
                            </li>
                            <li class="form-item">
                                <h4>地区选择</h4>

                                <div class="input-box">
                                    <input name="area_info" type="text" class="inp" id="varea_info" autocomplete="off"
                                           onchange="btn_check($('form'));" placeholder="地区信息" readonly="">
                                </div>
                            </li>
                            <li class="form-item">
                                <h4>详细地址</h4>

                                <div class="input-box">
                                    <input type="text" class="inp" name="vaddress" id="vaddress" autocomplete="off"
                                           oninput="writeClear($(this));" placeholder="街道门牌信息">
                                    <span class="input-del"></span></div>
                            </li>
                            <li class="form-item" style="text-align: center;font-size: 0.7rem;line-height: 2rem;">
                                <label>
                                    <input type="checkbox" class="checkbox" name="is_default" id="is_default" value="1">&nbsp;&nbsp;<i>设为默认地址</i>
                                </label>
                            </li>
                        </ul>
                        <div class="error-tips"></div>
                        <div class="form-btn"><a href="javascript:void(0);" class="btn">保存地址</a></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--新增收货地址End-->

    <!--商品列表Begin-->
    <div id="goodslist_before" class="mt5">
        <div id="deposit">
            <div class="nctouch-cart-container">

                <ul class="nctouch-cart-item">
                    <div class="ding hide">
                    </div>
                    <li class="buy-item">
                        <div class="goods-pic" >
                            <a>
                                <img :src="order_goods_detail.cover | img_src(100,100)">
                            </a>
                        </div>
                        <dl class="goods-info">
                            <dt class="goods-name">
                                <a>
                                    {{order_goods_detail.title}}
                                </a>
                            </dt>
                           <!--  <dd class="goods-type">规格:2.5L</dd> -->
                        </dl>
                        <div class="goods-subtotal">
                            <span class="goods-price" style="top:1.3rem">￥{{order_goods_detail.price}}</span>
                        </div>
                        <div class="goods-num" style="top: 1.939393rem;">
                            x1
                        </div>
                    </li>
                </ul>
                <div class="nctouch-cart-subtotal">
                    <dl>
                        <dt>配送方式</dt>
                        <dd>快递 <em id="storeFreight364">0.00</em>元</dd>
                    </dl>
                    <div class="message">
                        <input type="text" name="remarks" placeholder="买家备注" rel="364" id="storeMessage364">
                    </div>
                    <div class="store-total">
                        共1件商品&nbsp;小计：<span style="font-size:0.6rem;">￥<em id="storeTotal364">75.00</em></span>
                    </div>
                </div>


            </div>
        </div>
    </div>
    <!--商品列表End-->

    <!--<div id="rptVessel" class="nctouch-cart-block mt5 getRed">
        <div class="input-box">
            <label>
                <input type="checkbox" class="checkbox" id="useRPT">
                <span>平台红包</span>
                &lt;!&ndash;平台红包&ndash;&gt;
            </label>

            <p id="rptInfo">无可用红包</p>
        </div>
    </div>-->

    <!--底部总金额固定层Begin-->
    <div class="nctouch-cart-bottom" style="bottom: 0rem; z-index: 9">
        <div class="total order-detail-total"><span id="online-total-wrapper"></span>
            <dl class="total-money">
                <!--<dt>合计：</dt>
                <dd>￥<em id="totalPrice"></em></dd>-->
                <dt>合计:</dt>
                <dd>￥<em id="totalPayPrice">87.80</em></dd>
            </dl>
        </div>
        <div class="check-out ok"><a href="javascript:void(0);" id="ToBuyStep2">提交订单</a></div>
    </div>

</div>

<script>
new Vue({
    el: "#app",
    data : {
        'order_detail' : {},
        'order_sell_list' : [],
        'order_address_list' : [],
        'order_address_default' : {},
        'order_goods_detail' : {},
        'order_goods_id' : window.location.pathname.split('/').pop(),
        'order' : {
            'postage' : 0,
            'price' : 0,
            'num' : 1
        }
    },
    mounted: function(){
        $app.set_title('确认订单');
        this.$nextTick(()=>{
            // 获取收货地址列表
            this.get_address_list();

            // 获取产品信息
            this.get_goods();
        });
    },
    methods:{
        // 获取产品信息
        get_goods()
        {
            ajax.get('goods/detail/'+ this.order_goods_id).then((res)=>{
                this.order_goods_detail = res.data;

                this.order.price = this.order_goods_detail.price * this.order.num;

                if(this.order_goods_detail.postage_status == 2)
                {
                    if(this.order_goods_detail.postage_max_money > 0)
                    {
                        
                    }
                }
            });
        },
        // 获取全部收货地址
        get_address_list()
        {
            ajax.get('users/address/list').then((res)=>{
                this.order_address_list = res.data.list;

                if(this.order_address_list.length > 0)
                {

                    // 遍历元素获取默认的收货地址.
                    for(var item of this.order_address_list)
                    {
                        if(item.status == 1)
                        {
                            this.order_address_default = item;
                            break;
                        }
                    }

                    // 如果没有默认收货地址,获取第一条收货地址
                    if($app.empty(this.order_address_default) == false)
                    {
                        this.order_address_default = this.order_address_default[0];
                    }
                }

                //用户没有收货地址,发起添加收货地址
                if($app.empty(this.order_address_default) == false){
                    this.add_address();
                }
            });
        },
        // 添加收货地址方法
        add_address()
        {   
            // return false;
            layer.open({
              type: 1
              ,content: $('#select_address').html()
              ,anim: 'up'
              ,style: 'background:#fff;position:fixed; left:0; top:0; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;'
            });
        },
        // 修改收货地址
        up_address()
        {

        },
        // 删除收货地址
        del_address()
        {
            
        }
    }
});
</script>
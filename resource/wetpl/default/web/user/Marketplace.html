<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" id="favicon" href="" />
    <script src="/common/js/jquery-3.2.1.min.js"></script>
    <script src="/common/js/browser.min.js"></script>
    <script src="/common/js/jquery.imagecompress.js"></script>
    <link rel="stylesheet" href="{{PATH_TML}}user/common/css/main.css">
    <link rel="stylesheet" href="{{PATH_TML}}user/css/Marketplace.css">
    <title>主页应用</title>
    <link rel="stylesheet" href="/common/css/bootstrap.min.css">
    <link rel="stylesheet" href="/common/css/buttons.css">
    <link rel="stylesheet" href="/common/css/swiper.min.css">
    <script src="/common/js/bootstrap.min.js"></script>
    <script src="/common/js/swiper-3.3.1.min.js"></script>
    <script src="/common/js/buttons.js"></script>
    <script src="/common/js/layer/layer.js"></script>
</head>
<body style="width: 100%; background: #F7F6F2;">
<div class="login">
    <div class="left-nav">
    </div>
    <div id="top">
    </div>
    <div id="middle">
    </div>
    <div id="right">
         <div class="we-art-nav">
            <ol class="breadcrumb" style="margin-bottom:0;">
                <li class="homepage"><a>应用管理</a></li>
                <li class="active">主页应用</li>
            </ol>
        </div>
        <div id="center">
            <div class="center_top">
                <div><h5>基础功能</h5></div>
            </div>
            <div class="bottom">
                <ul class="list-group">
                    <li class="list-group-item">
                        <div>
                            <p>文章板块</p>
                            <div class="toggle-button-wrapper">
                                <input type="checkbox" id="toggle-button" class="" name="switch">
                                <label for="toggle-button" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>

                        </div>
                        <span>管理</span>
                    </li>
                    <li class="list-group-item">
                        <div>
                            <p>项目板块</p>
                            <div class="toggle-button-wrapper">
                                <input type="checkbox" id="toggle-button-1" name="switch">
                                <label for="toggle-button-1" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>
                        </div>
                        <span>管理</span>
                    </li>
                    <li class="list-group-item">
                        <div>
                            <p>活动板块</p>
                            <div class="toggle-button-wrapper">
                                <input type="checkbox" id="toggle-button-2" name="switch">
                                <label for="toggle-button-2" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>
                        </div>
                        <span>管理</span>
                    </li>
                    <li class="list-group-item"  >
                        <div>
                            <p>圈子板块</p>
                            <div class="toggle-button-wrapper">
                                <input type="checkbox" id="toggle-button-3" name="switch">
                                <label for="toggle-button-3" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>
                        </div>
                        <span>管理</span>
                    </li>
                    <li class="list-group-item">
                        <div>
                            <p>商城管理</p>
                            <div class="toggle-button-wrapper">
                                <input type="checkbox" id="toggle-button-4" class="" name="switch">
                                <label for="toggle-button-4" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>
                        </div>
                        <span>管理</span>
                    </li>
                    <!--<li class="list-group-item" style="display: none">
                        <div>
                            <p>CRM管理</p>
                            <div class="toggle-button-wrapper">
                                <input type="" id="toggle-button-5" class="" name="switch">
                                <label for="toggle-button-5" class="button-label">
                                    <span class="circle"></span>
                                    <span class="text on">ON</span>
                                    <span class="text off">OFF</span>
                                </label>
                            </div>
                        </div>
                        <span>管理</span>
                    </li>-->
                </ul>
            </div>
        </div>
    </div>
    </div>
    <script src="{{PATH_CONFIG}}"></script>
<script src="/common/js/control.js"></script>
<script src="{{PATH_TML}}user/js/common.js"></script>
<script src="{{PATH_TML}}user/common/js/generate_manage.js"></script>
<script src="{{PATH_TML}}user/js/market.js"></script>
<script>
    var modeleName = [];
    var moduleState = function() {
        $.ajax({
            url: apiUrl+'pages/modulerun/list',
            type: 'GET',
            headers: {
                'Token': localStorage.getItem('token')
            },
            success: function(data){
                if (data.code == 200){
                    console.log('module:', data.data);
                    var state = data.data.list;
               
                        state.map(x => {
                        if (x.module_name == '文章模块') {
                            modeleName.push({id: x.module_id, name: '.we-art',cname:'#toggle-button', status: x.status});    
                        }

                        if (x.module_name == '商城模块') {
                            modeleName.push({id: x.module_id, name: '.we-shop',cname:'#toggle-button-4', status: x.status});
                        }
                        if (x.module_name == '活动模块') {
                            modeleName.push({id: x.module_id, name: '.we-active',cname:'#toggle-button-2', status: x.status});
                        }
                        if (x.module_name == '项目模块') {
                            modeleName.push({id: x.module_id, name: '.we-project',cname:'#toggle-button-1', status: x.status});
                        }
                        if (x.module_name == '圈子模块') {
                            modeleName.push({id: x.module_id, name: '.we-crm',cname:'#toggle-button-3', status: x.status});
                        }

                    })

                    modeleName.map(x => {
                        console.log(x);
                        $(x.cname).addClass(x.id)

                        if (x.status == 1) {
                            $(x.name).slideDown(500)
                            console.log(x.name);
                            $(x.name).show();
                            $(x.cname).prop("checked", true);

                        }

                        $(x.cname).click(function(){
                            var cid = $(this).attr('class')
                            console.log(cid,x.name);
                            if($(this).is(":checked")){
                                changeStatus(cid);
                                $(x.name).stop().slideDown(500);
                            }else {
                                changeStatus(cid);
                                $(x.name).stop().slideUp(500);
                            }
                        });
                    })

                    /*$('#toggle-button').click(function(){
                        var cid = $(this).attr('class')
                        if($(this).is(":checked")){
                            changeStatus(cid);
                            $('.we-art').stop().slideDown(500);
                        }else {
                            changeStatus(cid);
                            $('.we-art').stop().slideUp(500);
                        }
                    });
                    $('#toggle-button-4').click(function(){
                        var cid = $(this).attr('class')
                        if($(this).is(":checked")){
                            changeStatus(cid);
                            $('.we-shop').stop().slideDown(500);
                        }else {
                            changeStatus(cid);
                            $('.we-shop').stop().slideUp(500);
                        }
                    });*/
                } else {
                    /*layer.msg(data.message, {
                        time: 1500
                    });*/
                }

                //列表折叠
                var curr = 'we-app';
                var status = true;
                var list = ['we-set','we-art','we-shop','we-active','we-project','we-app','we-crm','we-log'];

                var remove = function(id, list) {
                    return list.filter(x => x != id);
                }

                $("." + curr + ":eq(0)").css("border-bottom", "1px solid #eeeeee");
                $("." + curr + " span img").css("transform", "rotate(90deg)");
                remove(curr, list).map(x => $("." + x + ":eq(1)").stop().hide());

                var showList = function(state, id) {
                    var id = "." + id;
                    if (state) {
                        $(id + ":eq(1)").stop().hide(300);
                        if (id != ".we-log") {
                            $(id + ":eq(0)").css("border-bottom", "0");
                        }
                        $(id + " span img").css("transform", "rotate(0deg)")
                        status = false;
                    } else {
                        $(id + ":eq(1)").stop().show(300);
                        $(id + " span img").css("transform", "rotate(90deg)")
                        $(id + ":eq(0)").css("border-bottom", "1px solid #eeeeee");
                        status = true;
                    }
                }

                list.map(x => {
                    $("." + x).click(function() {
                        var isCont = $(this).attr('class').search('we-cont');
                        if (isCont == 0) {
                            return;
                        }
                        if (curr == x) {                            
                            showList(status, x);
                        } else {
                            status = false;
                            remove(x, list).map(x => {
                                $("." + x + ":eq(1)").stop().hide(300)
                                $("." + x + " span img").css("transform", "rotate(0deg)")
                            });
                            if (curr != "we-log") {
                                $("." + curr + ":eq(0)").css("border-bottom", "0");
                            }
                            curr = x;                            
                            showList(status, x);
                        }
                    })
                })
            },
            error: function(xhr){
                console.log(xhr);
            }
        })
    }

    moduleState();

	var changeStatus = function(mid) {
        $.ajax({
            url: apiUrl+'pages/modulerun/setModuleStatus',
            type: 'POST',
            data: {moduleId: mid},
            headers: {
                'Token': localStorage.getItem('token')
            },
            success: function (data) {
                if (data.code == 200) {
                    console.log('open:', data);
                    sessionStorage.moduledata="";
                    sessionStorage.statedata="";
                } else {
                    // layer.msg(data.message, {
                    //     time: 1500
                    // });
                }
            },
            error: function (xhr) {
                console.log(xhr);
            }
        })
    }

  

</script>

</body>
</html>



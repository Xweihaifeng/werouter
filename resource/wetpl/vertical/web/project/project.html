<#extend#>public/extend/index_extend.html</#extend#>
<link rel="stylesheet" href="/common/magazine/css/iview.css">
<link rel="stylesheet" href="{{PATH_TML}}activity/css/cate_list.css" />
<link rel="stylesheet" href="{{PATH_TML}}project/css/project.css">
<script src="/common/magazine/js/iview.min.js"></script>

<style>
    .demo-spin-icon-load{
        animation: ani-demo-spin 1s linear infinite;
    }
    @keyframes ani-demo-spin {
        from { transform: rotate(0deg);}
        50%  { transform: rotate(180deg);}
        to   { transform: rotate(360deg);}
    }
    .demo-spin-col{
        height: 100px;
        position: relative;
        border: 1px solid #eee;
    }
</style>

<div id="container" v-cloak>
    <div id="proj">
        <div id="find">
            <div id="type">
                <p>分类：</p>
                <ul>
                    <li v-for="(e, i) in type" @click="show(e, 'type0')" :style="e.style">{{e.title}}</li>
                </ul>
            </div>
            <div id="time">
                <p>时间：</p>
                <ul>
                    <li v-for="(e, i) in time" @click="show(e, 'type1')" :style="e.style">{{e.name}}</li>
                </ul>
            </div>
            <div id="type2">
                <ul>
                    <!--<li @click="show('total', 'type2')" :class="{'style-active-blue': showType.total}">综合</li>-->
                    <li @click="show('latest', 'type2')" :class="{'style-active-blue': showType.latest}">最新</li>
                    <li @click="show('hotest', 'type2')" :class="{'style-active-blue': showType.hotest}">最热</li>
                </ul>
                <ul>
                    <li @click="show('proj', 'type3')" :class="{'style-active-red': showType.proj}">方格</li>
                    <li @click="show('act', 'type3')" :class="{'style-active-red': showType.act}">条目</li>
                </ul>
            </div>
        </div>
        <div id="projects" v-show="showType.proj">
            <ul>
                <a v-for="e in proj" :href="'/' + e.domain + '/activitydetail/' + e.weid">
                    <li>
                        <div :class="status[e.onStatus]"></div>
                        <img :src="setImg(e.cover, '/common/img/p04.png', 285, 160)" alt="" width="285" height="160"/>
                        <div class="act">
                            <p>{{e.title | cut(30)}}</p>
                            <p>{{e.begain_time + ' ' + e.begain_week + ' 开始'}}</p>
                            <p>
                               <span>
                                    <img :src="setImg(e.avatar, '/common/img/p05.png', 28, 28)" alt="" style="width:28px;height:28px;border-radius:28px;"/>
                                    <span>{{e.enroll_num + '/' + e.enroll_limit}} 人已报名</span>
                               </span>
                               <span :class="{free: e.isFree, price: !e.isFree}">{{e.price}}</span>
                            </p>
                        </div>
                    </li>
                </a>
            </ul>
        </div>

        <div class="cat-con" v-show="showType.act">
            <ul class="cont-list">
                <li v-for="item in act">
                    <a href="javascript:void(0);">
                        <img :src="item.image" alt="">
                    </a>
                    <div class="abstract">
                        <a href="javascript:void(0);">
                            <h3>{{item.title}}</h3>
                            <p>{{item.info}}</p>
                        </a>
                        <div class="abst-info">
                            <div class="info-son">
                                <img src="{{PATH_TML}}activity/img/时间.png" alt="">
                                <span>{{item.time}}</span>
                            </div>
                            <div class="info-son">
                                <img src="{{PATH_TML}}activity/img/地点.png" alt="">
                                <span>{{item.add}}</span>
                            </div>
                            <div class="info-son">
                                <img src="{{PATH_TML}}activity/img/人员.png" alt="">
                                <span>{{item.active}}</span>人已报名
                            </div>
                        </div>
                    </div>
                    <div class="attend" v-if="item.price == '免费'">
                        <span>{{item.price}}</span>
                        <button>立即报名</button>
                    </div>
                    <div class="attend" v-else="item.price != '免费'">
                        <span class="attebd_cur">￥{{item.price}}</span>
                        <button class="button_cur">立即报名</button>
                    </div>
                </li>
            </ul>
        </div>

        <!--<Spin fix>
            <Icon type="load-a" size=30 class="demo-spin-icon-load"></Icon>
            <div>加载中</div>
        </Spin>-->

        <div id="pages">
            <Page :total="parseInt(pages.total)" :current="pages.page" :page-size="pages.limit" @on-change="change"></Page>
        </div>
    </div>
</div>

<script>
    var activity = new Vue({
        el: '#container',
        data: {
            showType: {act: false, proj: true, total: false, latest: true, hotest: false},
            pageStore: [{id: 'proj', total: 12, page: 1, limit: 12}, {id: 'act', total: 10, page: 1, limit: 10}],
            pages: {},
            type: [],
            time: [],
            proj: [],
            act: [],
            status: {'已发布': 'prepare', '进行中': 'doing', '已结束': 'end'},
            url: apiUrl + 'activity/lists',
            args: {cate_id: '', time_scope: '', order: ''}
        },
        created: function(){
            var dataTime = ['不限', '今天', '近三天', '近一周', '近一月'];
            this.time = dataTime.map((x, i) => i === 0 ? ({id: i, name: x, style: {'color': '#4caaed'}}) : ({id: i, name: x, style: {}}));
            this.act = [
                {"image":"/resource/wetpl/vertical/web/activity/img/01.png","title":"互联网运营50堂必修课，如何玩转产品、用户、渠道、数据？","info":"50节系统化实战课程、是面向0到3年得互联网从业者和爱好者学习的内容，从零基础打造运营思维体系，深度学习互联网运营、产品、用户、渠道、营销的实操，具体怎么做，通过运营模型及实例让你快速进阶...","price":"免费","active":"196","time":"本周五 12:30 开始","add":"高新区"},
                {"image":"/resource/wetpl/vertical/web/activity/img/02.png","title":"互联网运营50堂必修课，如何玩转产品、用户、渠道、数据？","info":"50节系统化实战课程、是面向0到3年得互联网从业者和爱好者学习的内容，从零基础打造运营思维体系，深度学习互联网运营、产品、用户、渠道、营销的实操，具体怎么做，通过运营模型及实例让你快速进阶...","price":578,"active":"196","time":"下周三 15:30 开始","add":"雁塔区"},
                {"image":"/resource/wetpl/vertical/web/activity/img/03.png","title":"互联网运营50堂必修课，如何玩转产品、用户、渠道、数据？","info":"50节系统化实战课程、是面向0到3年得互联网从业者和爱好者学习的内容，从零基础打造运营思维体系，深度学习互联网运营、产品、用户、渠道、营销的实操，具体怎么做，通过运营模型及实例让你快速进阶...","price":20,"active":"196","time":"2018-01-24 14:29 开始","add":"未央区"},
                {"image":"/resource/wetpl/vertical/web/activity/img/04.png","title":"互联网运营50堂必修课，如何玩转产品、用户、渠道、数据？","info":"50节系统化实战课程、是面向0到3年得互联网从业者和爱好者学习的内容，从零基础打造运营思维体系，深度学习互联网运营、产品、用户、渠道、营销的实操，具体怎么做，通过运营模型及实例让你快速进阶...","price":666,"active":"196","time":"下周日 12:30 开始","add":"世纪广场"}
            ]

            axios.get(apiUrl + 'activity/cate/lists').then(data => {
                this.type = data.data.data.list.map((e, i) => i === 0 ? ({title: '全部', weid: '', style: {'color': '#4caaed'}}) : (e.style = {}, e));
            })

            this.getList(this.url, '', '', '', 1, 12);
        },
        methods: {
            change: function(page){
                this.pages.page = page;
                this.getList(this.url, '', '', '', page, this.pages.limit);
            },
            show: function(o, type){
                switch(type){
                    case 'type0' : this.type.map(e => e.title === o.title ? e.style = {'color': '#4caaed'} : e.style = {});
                        this.args.cate_id = o.weid;
                        this.getList(apiUrl + 'activity/lists', this.args.cate_id, this.args.time_scope, this.args.order, 1, this.pages.limit);
                        break;
                    case 'type1' : this.time.map(e => e.name === o.name ? e.style = {'color': '#4caaed'} : e.style = {});
                        this.args.time_scope = o.id;
                        this.getList(apiUrl + 'activity/lists', this.args.cate_id, this.args.time_scope, this.args.order, 1, this.pages.limit);
                        break;
                    case 'type2' : var id = ['latest', 'hotest'].map((e, i) => o === e ? (this.showType[e] = true, i) : (this.showType[e] = false, null)).filter(x => x != null)[0];
                        this.args.order = id;
                        this.getList(apiUrl + 'activity/lists', this.args.cate_id, this.args.time_scope, this.args.order, 1, this.pages.limit);
                        break;
                    case 'type3' : ['act', 'proj'].map(e => o === e ? (this.showType[e] = true) : (this.showType[e] = false));
                        //map1保存并更新pageStore状态，map2更新pages状态，只限两个类别有效
                        this.pageStore = this.pageStore.map(e => o === e.id ? e : this.pages).map(e => o === e.id ? this.pages = e : e); break;
                    default: break;
                }
            },
            setImg: function(url, init, w, h, mode){
                if (url != '' && url != null && url != undefined) {
                    if (url.indexOf('http') === -1 && url.indexOf('common') === -1) {
                        return mode != undefined ? ApiMaterPlatQiniuDomain + url + '?imageView2/' + mode + '/w/' + w + '/h/' + h
                                : ApiMaterPlatQiniuDomain + url + '?imageView2/3/w/' + w + '/h/' + h;
                    } else {
                        return url;
                    }
                } else {
                    return init;
                }
            },
            getList: function(url, cate_id, time_scope, order, page, limit){
                axios.get(url + '?cate_id=' + cate_id + '&time_scope=' + time_scope + '&order=' + order + '&page=' + page + '&limit=' + limit).then(data => {
                    var info = data.data.data;
                    this.showType.proj ? (this.pageStore[0].total = info.total, this.pages = this.pageStore[0],
                            this.proj = info.list.map(e => e.type != 1 ? (e.isFree = false, e.price = '¥' + e.price, e) : (e.isFree = true, e.price = '免费', e)))
                            : ''//(this.pageStore[1].total = info.total, this.pages = this.pageStore[1], this.act = info.list);
                })
            }
        },
        filters: {
            cut: function(value, len) {
                return value.length > len ? value.substr(0, len) + '...' : value
            }
        }
    })
</script>
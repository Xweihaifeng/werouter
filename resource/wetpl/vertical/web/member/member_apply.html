<#extend#>public/extend/index_extend.html</#extend#>
    <!--中间样式开始-->
    <link rel="stylesheet" href="/resource/wetpl/substation/default/web/css/list.css">
    <link rel="stylesheet" href="/resource/wetpl/substation/default/web/css/newsert.css">
    <link rel="stylesheet" href="{{PATH_TML}}member/css/member_apply.css" />

    <div id="container">
        <!--位置显示-->
        <div class="seat">
            <img src="/resource/wetpl/substation/default/web/image/fanhui.png" alt="" style="margin-top: -3px" /> 当前位置在：<a href="">首页</a> > 加入商会 > 入会申请 <span class="wz"></span>
            <div class="er-nav" id="menuTwo"></div>
        </div>

        <article class="news-main">
            <!--左侧内容-->
            <article class="main">
                <h2 style="margin-top: 0px">
                    <strong>加入商会</strong>
                    <span style="margin-top: 10px;">Chamber Application</span>
                </h2>
                <ul class="aside" id="menuX">
                    <li> <a class="chan_li" id="oooo"> 商会首页 </a> </li>
                    <li :class="{cenav_cur: item.domain == 'rhsq'}" v-for="(item,index) in column_list"><a :id="item.domain" :href="item.domain == 'rhsq' ? '/apply' : '/org/'+ item.domain">{{ item.title }}</a></li>
                </ul>
            </article>

            <!--右侧内容-->
            <article class="list-big">
                <div class="member_apply_list">

                    <!-- 会员申请快速登陆 -->
                    <div class="already already_logged" v-if="already.login">
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请人电话： </div>
                            <input type="text" class="member_app_input" size="11" maxlength="11" wrap="hard" cols="100" placeholder="填写本人常用手机号码" v-model="member.login.phone">
                        </div>
                        <div class="member_sel_type member_link_login">
                            <div class="member_type_title"> 手机验证码： </div>
                            <input type="text" class="member_app_input" size="6" maxlength="6" wrap="hard" cols="100" placeholder="请输入手机验证码" v-model="member.login.code">
                            <button class="member_app_input member_onlink_card" @click="login(member.login.phone,member.login.code)"> 在线验证 </button>
                            <button class="member_app_input member_get_card" @click="codes(member.login.phone)"> {{get_card? get_card : '获取验证码'}} </button>
                        </div>
                    </div>

                    <!-- 实名认证 -->                    
                    <div class="continue" :style="{'borderColor': cont_status.auth.color}" id="auth_cont" v-if="already.auth_cont">
                        <img :src="cont_status.auth.img" alt="">
                        <p v-html="cont_status.auth.info"></p>
                        <p v-if="cont_status.auth.btn" v-html="cont_status.auth.btn"></p>
                    </div>
                    <div class="already already_auth" v-if="already.auth">
                        <nav class="member_nav">
                            <menu> 实名认证 </menu>
                        </nav>
                        <article>
                            <div class="member_auth">
                                <div class="member_sel_type">
                                    <div class="member_type_title"> 身份证姓名： </div>
                                    <input class="member_auth_input" size="15" maxlength="20" wrap="hard" cols="100" placeholder="请填写本人身份证姓名" v-model="member.auth.name">
                                </div>
                                <div class="member_sel_type">
                                    <div class="member_type_title"> 身份证号码： </div>
                                    <input class="member_auth_input" size="15" maxlength="18" wrap="hard" cols="100" placeholder="请填写本人身份证号码" title="身份证号码为 15 或 18 位"  v-model="member.auth.card_id">
                                </div>
                                <div class="member_sel_type">
                                    <div class="member_type_title"> 身份证正面： </div>
                                    <div id="card_front" class="member_file" :style="{backgroundImage: 'url('+ setBg(member.auth.card_front, '/common/img/negative.png') +')'}">
                                        <input type="file" @change="InitQiNiv('auth', 'card_front')" placeholder="身份证正面上传" :name="member.auth.card_front">
                                    </div>
                                </div>
                                <div class="member_sel_type">
                                    <div class="member_type_title"> 身份证背面： </div>
                                    <div id="card_back" class="member_file" :style="{backgroundImage: 'url('+ setBg(member.auth.card_back, '/common/img/positive.png') +')'}">
                                        <input type="file" @change="InitQiNiv('auth', 'card_back')" placeholder="身份证背面上传" :name="member.auth.card_back">
                                    </div>
                                </div>
                                <div class="member_btn_box">
                                    <button class="member_auth_submit" id="auth_sub" @click="art_auth('auth')"> 提交 </button>
                                    <button class="member_auth_submit" id="auth_up" @click="art_auth('Uauth')"> 修改 </button>
                                </div>
                            </div>
                        </article>
                    </div>

                    <!-- 官方认证 -->
                    <div class="continue" :style="{'borderColor': cont_status.cert.color}" id="cert_cont" v-if="already.cert_cont">
                        <img :src="cont_status.cert.img" alt="">
                        <p v-html="cont_status.cert.info"></p>
                        <p v-if="cont_status.cert.btn" v-html="cont_status.cert.btn"></p>
                    </div>
                    <div class="already already_cert" v-if="already.cert">
                        <nav class="member_nav">
                            <menu> 官方认证 </menu>
                        </nav>
                        <nav class="member_sel_type">
                            <div class="member_type_title">认证类型：</div>
                            <div v-for="(item, index) in cert_tabs" class="member_type_tab"><input type="radio" :id="'cert'+index" name="certs" :value="index" v-model="pickeds" @click="cert_tab(index)"><label :for="'cert'+index"> {{ item }}</label></div>
                        </nav>
                        <article>
                            <div v-for="(item, index) in cert_tabs">
                                <!-- 个人认证 -->
                                <div class="member_personal" v-if="index == 0" v-show="index == pickeds">
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 身份证姓名： </div>
                                        <input class="member_personal_input" size="15" maxlength="20" wrap="hard" cols="100" placeholder="请填写本人身份证姓名" v-model="member.cert.name">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 身份证号码： </div>
                                        <input class="member_personal_input" size="15" maxlength="18" wrap="hard" cols="100" placeholder="请填写本人身份证号码" title="身份证号码为 15 或 18 位" v-model="member.cert.card_id">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 加V认证： </div>
                                        <textarea class="member_personal_textarea" rows="3" placeholder="请如实填写你的加V认证资料，填写后可更好的彰显你的身份" v-model="member.cert.cert_info"></textarea>
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 证明资料： </div>
                                        <div id="per_cert_imgs" class="member_file1" :style="{backgroundImage: 'url('+ setBg(member.cert.per_cert_imgs, '/common/img/default_img.png') +')'}" v-model="member.cert.per_cert_imgs">
                                            <input type="file" @change="InitQiNiv('cert', 'per_cert_imgs')" placeholder="身份证背面上传" :name="member.cert.per_cert_imgs">
                                        </div>
                                    </div>
                                    <div class="member_btn_box">
                                        <button class="member_personal_submit" id="cert_sub" @click="art_auth('cert')"> 提交 </button>
                                        <button class="member_personal_submit" id="cert_up" @click="art_auth('Ucert')"> 修改 </button>
                                    </div>
                                </div>

                                <!-- 机构认证 -->
                                <div class="member_institutional" v-if="index == 1" v-show="index == pickeds">
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 机构名称： </div>
                                        <input class="member_institutional_input" placeholder="请输入你所在的机构名称" v-model="member.inst.org_name">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 营业执照： </div>
                                        <div class="member_file1" id="org_license_image" :style="{backgroundImage: 'url('+ setBg(member.inst.org_license_image, '/common/img/default_img.png') +')'}" v-model="member.inst.org_license_image">
                                            <input type="file" @change="InitQiNiv('inst', 'org_license_image')" placeholder="请上传营业执照" :name="member.inst.org_license_image">
                                        </div>
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 工商执照： </div>
                                        <input class="member_institutional_input" placeholder="请参照营业执照人输入" v-model="member.inst.org_cert_number">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 一般经营范围： </div>
                                        <input class="member_institutional_input" placeholder="请参照营业执照人输入" v-model="member.inst.org_scope_common">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 前置经营范围： </div>
                                        <input class="member_institutional_input" placeholder="请参照营业执照人输入" v-model="member.inst.org_scope_front">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 企业类型： </div>
                                        <input class="member_institutional_input" placeholder="请参照营业执照人输入" v-model="member.inst.org_type">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 企业成立日期： </div>
                                        <input type="date" class="member_institutional_input" placeholder="企业成立日期" v-model="member.inst.org_setup_date">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 授权资料： </div>
                                        <div class="member_file1" id="org_auth_imgs" :style="{backgroundImage: 'url('+ setBg(member.inst.org_auth_imgs, '/common/img/default_img.png') +')'}" v-model="member.inst.org_auth_imgs">
                                            <input type="file" @change="InitQiNiv('inst', 'org_auth_imgs')" placeholder="请上传授权资料" :name="member.inst.org_auth_imgs">
                                        </div>
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 联系人姓名： </div>
                                        <input class="member_institutional_input" placeholder="联系人真实姓名" v-model="member.inst.org_contact_people">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 联系人电话： </div>
                                        <input class="member_institutional_input" size="11" maxlength="11" wrap="hard" cols="100" placeholder="请输入联系人电话" v-model="member.inst.org_contact_phone">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 联系人地址： </div>
                                        <input class="member_institutional_input" placeholder="请输入联系人地址" v-model="member.inst.org_address">
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 加V认证： </div>
                                        <textarea class="member_institutional_textarea" rows="3" placeholder="请如实填写你的加V认证资料，填写后可更好的彰显你的身份" v-model="member.inst.cert_info"></textarea>
                                    </div>
                                    <div class="member_sel_type">
                                        <div class="member_type_title"> 证明资料： </div>
                                        <div class="member_file1" id="org_cert_imgs" :style="{backgroundImage: 'url('+ setBg(member.inst.org_cert_imgs, '/common/img/default_img.png') +')'}" v-model="member.inst.org_cert_imgs">
                                            <input type="file" @change="InitQiNiv('inst', 'org_cert_imgs')" placeholder="请上传证明资料" :name="member.inst.org_cert_imgs">
                                        </div>
                                    </div>
                                    <div class="member_btn_box">
                                        <button class="member_institutional_submit" id="inst_sub" @click="art_auth('inst')"> 提交 </button>
                                        <button class="member_institutional_submit" id="inst_up" @click="art_auth('Uinst')"> 修改 </button>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </div>

                    <!-- 会员申请 -->
                    <div class="continue" :style="{'borderColor': cont_status.apply.color}" id="apply_cont" v-if="already.apply_cont">
                        <img :src="cont_status.apply.img" alt="">
                        <p v-html="cont_status.apply.info"></p>
                        <p v-if="cont_status.apply.btn" v-html="cont_status.apply.btn"></p>
                        
                    </div>
                    <div class="already already_apply" v-if="already.apply">
                        <nav class="member_nav">
                            <menu> 会员申请 </menu>
                        </nav>
                        <!-- 会员类型 -->
                        <div class="member_sel_type">
                            <div class="member_type_title"> 选择类型： </div>
                            <ul class="member_sel_type_name">
                                <li v-for="(item,index) in member_levels.list" :class="{'member_active1': index == member_levels.type_active, 'member_tyle_2': item.open_type == 2}" @click="levels_list(item,index)">{{ item.level_name }}</li>
                            </ul>
                        </div>

                        <!-- 会员缴费 -->
                        <div class="member_cost">
                            <span class="member_warn"></span><span id="display_name">{{JSON.stringify(member_position) == '{}'? '普通会员' : member_position.level_name}}</span> 费用为 <span class="member_count">￥<span id="member_price">{{JSON.stringify(member_position) == '{}'? '0.01' : member_position.price}}</span>元</span> / 年 <span class="member_danger"> *在初审通过之前无需缴费 </span>
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 入会须知： </div>
                            <div  class="display_flex">
                                <a class="member_a_style term_servcice_rule"> 《 会员服务管理规范 》 </a>、
                                <a class="member_a_style constitution"> 《 协会章程 》 </a>、
                                <a class="member_a_style apply_template"> <img src="{{PATH_TML}}member/img/dowload.png"> 会员申请书模板下载 </a>
                            </div>
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请类型： </div>
                            <div class="member_type_tab"><input id="personal_apply" type="radio" name="cert" value=1 v-model="member.apply.apply_type"><label for="personal_apply"> 个人申请 </label></div>
                            <div class="member_type_tab"><input id="institution_apply" type="radio" name="cert" value=2 v-model="member.apply.apply_type"><label for="institution_apply"> 机构申请 </label></div>
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请书： </div>
                            <div id="plat_member_application" class="member_file1" :style="{backgroundImage: 'url('+ setBg(member.apply.plat_member_application, '/common/img/default_img.png') +')'}" v-model="member.apply.plat_member_application">
                                <input type="file" @change="InitQiNiv('apply', 'plat_member_application')" placeholder="请上传申请资料">
                            </div>
                            <div class="member_danger"> <span class="member_warn"></span> *请下载、填写、签章、扫描、并上传 </div>
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请人： </div>
                            <input type="text" class="member_app_input" placeholder="填写本人真实姓名" v-model="member.apply.plat_member_contacts">
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请人电话： </div>
                            <input type="text" class="member_app_input" placeholder="填写本人真实姓名" v-model="member.apply.plat_member_tel">
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请单位： </div>
                            <input type="text" class="member_app_input" placeholder="公司名称" v-model="member.apply.member_int_name">
                            <div class="member_danger"> <span class="member_warn"></span> *机构认证者可填写此项 </div>
                        </div>
                        <div class="member_sel_type">
                            <div class="member_type_title"> 申请地址： </div>
                            <input type="text" class="member_app_input" placeholder="填写详细的地址" v-model="member.apply.plat_member_address">
                        </div>
                        <div class="member_sel_type member_agree">
                            <input type="checkbox" class="member_con_left" v-model="member.apply.is_agree_terms">
                            <div>
                                <span> &ensp;已阅读，并自愿遵守 </span>
                                <a class="member_a_style term_servcice_rule">《会员服务管理规范》</a>
                                <a class="member_a_style constitution">《协会章程》</a>
                            </div>
                        </div>
                        <div class="member_sel_type">
                            <input type="button" class="member_con_left member_app_submit" value="提交申请" id="apply_sub" @click="art_auth('apply')">
                            <input type="button" class="member_con_left member_app_submit" value="修改申请" id="apply_up" @click="art_auth('Uapply')">
                        </div>
                    </div>

                    <!-- 流程 -->
                    <ul class="member_process">
                        <li :class="{process_active: item.state}" v-for="item in process">{{item.title}}</li>
                    </ul>
                </div>
            </article>
        </article>
    </div>

<script>
    var app = new Vue({
        el: '#container',
        data: {
            column_list: [],        // 频道栏目列表
            member_levels: {list: [], type_active: 0},      // 会员等级
            member_position: {},
            process: [
                { state:false, name:'apply',  title:"会员申请" },
                { state:false, name:'first',  title:"初审" },
                { state:false, name:'money',  title:"缴费" },
                { state:false, name:'second', title:"复审" },
                { state:false, name:'member', title:"正式会员"}
            ],
            member_set_type: [],
            pages_page_info: {},
            member_price: '',
            get_card: '',
            get_card_state: false,
            is_agree : true,
            cert_tabs: ["个人认证", "机构认证"],
            cert_num: 0,
            already: {
                login: false,                        // 已经登陆
                auth: false,  auth_cont: false,     // 已经实名
                cert: false,  cert_cont: false,    // 已经官方
                apply: false, apply_cont: false,  // 已经申请
            },
            pickeds: 0,   // 官方认证类型选择
            member: {
                login: {
                    phone: '',
                    code: ''
                },
                auth:  {
                    name: '',
                    card_id: '',
                    card_front: null,
                    card_back: null
                },
                cert:  {
                    type: 1,
                    name: '',
                    card_id: '',
                    per_cert_imgs: null,
                    cert_info: ''
                },
                inst:  {
                    type: 2,
                    org_name:'',
                    org_license_image:null,
                    org_cert_number: '',
                    org_scope_common: '',
                    org_scope_front: '',
                    org_type: '',
                    org_setup_date: '',
                    org_auth_imgs: null,
                    org_contact_people: plats_user_info.real_name,
                    org_contact_phone: plats_user_info.phone,
                    org_address: '',
                    cert_info: '',
                    org_cert_imgs: null
                },
                apply: {
                    apply_type: 1,
                    session_id: '',
                    plat_member_level_id: '',
                    plat_member_organization: '',
                    plat_member_contacts: plats_user_info.real_name,
                    plat_member_tel: plats_user_info.phone,
                    plat_member_address: '',
                    plat_member_application: null,
                    is_agree_terms: true
                }
            },
            cont_state: ['实名认证中……', '实名认证被拒绝', '个人认证中……', '个人认证被拒绝', '机构认证中……', '机构认证被拒绝', '会员申请中……'],
            cont_status: {
                auth : { name: 'auth_status', img: '/common/img/member/+01.png', info: '<span>实名认证<span> 审核中， 请耐心等待... ...', btn: '', color: '' },
                cert : { name: 'cert_status', img: '/common/img/member/+01.png', info: '<span>官方认证<span> 审核中， 请耐心等待... ...', btn: '', color: '' },
                apply: { name: 'apply_status', img: '/common/img/member/+01.png', info: '<span>会员申请<span> 审核中， 请耐心等待... ...', btn: '', color: '' }
            }
        },
        http: {
            headers: {
                token: plats_token,
            }
        },
        created() {
            var self = this;
            // 频道栏目列表
            ajax.get(CMS_CHANNEL_CATEGORIES + "org").then(res => {
                this.column_list = res.data;
            });

            // 会员等级
            ajax.get('/member/session/current').then((res) => {
                self.member.apply.session_id = res.data.weid;
                var result = res.data.config.reverse();
                var member_config = result.map((x,y) => {x.number = y; return x}).filter(e => e.open_type != 2)[0];
               /* var member_config = result.map((x,y) => x.number = y).filter(e => e.open_type != 2)[0];*/
                this.member_position = member_config;
                this.member.apply.plat_member_level_id = member_config.mid;
                this.member_levels.type_active = member_config.number;
                this.member_levels.list = result;
            })

            // 会员资料
            this.member_setting();
        },        
        mounted() {
            this.$nextTick(() => {
                if(!plats_token) {
                    this.already.login = true;
                } else {
                    // this.process_filters('login');
                    this.auth_certification();
                }
            })
        },
        methods: {
            status(num) {
                switch (num) {
                    case 0:
                        this.cont_status.auth.color = '#52a0e8';
                        this.cont_status.auth.img = '/common/img/member/+01.png';
                        this.cont_status.auth.info = '<span style="color: #52a0e8">实名认证</span> 审核中，请耐心等待... ...';
                        break;
                    case 1:
                        this.cont_status.auth.color = '#e85252';
                        this.cont_status.auth.img = '/common/img/member/+02.png';
                        this.cont_status.auth.info = '<span style="color: #e85252">实名认证</span> 审核失败';
                        break;
                    case 2:
                        this.cont_status.auth.color = '#31CB51';
                        this.cont_status.auth.img = '/common/img/member/+03.png';
                        this.cont_status.auth.info = '<span style="color: #31CB51">实名认证</span> 审核通过，您已认证成功';
                        break;
                    case 3:
                        this.cont_status.cert.color = '#52a0e8';
                        this.cont_status.cert.img = '/common/img/member/+01.png';
                        this.cont_status.cert.info = '<span style="color: #52a0e8">官方认证</span> 审核中，请耐心等待... ...';
                        break;
                    case 4:
                        this.cont_status.cert.color = '#e85252';
                        this.cont_status.cert.img = '/common/img/member/+02.png';
                        this.cont_status.cert.info = '<span style="color: #e85252">官方认证</span> 审核失败';
                        break;
                    case 5:
                        this.cont_status.cert.color = '#31CB51';
                        this.cont_status.cert.img = '/common/img/member/+03.png';
                        this.cont_status.cert.info = '<span style="color: #31CB51">官方认证</span> 审核通过，您已认证成功';
                        break;
                    case 6:
                        this.cont_status.apply.color = '#52a0e8';
                        this.cont_status.apply.img = '/common/img/member/+01.png';
                        this.cont_status.apply.info = '<span style="color: #52a0e8">会员申请</span> 审核中，请耐心等待... ...';
                        break;
                    case 7:
                        this.cont_status.apply.color = '#e85252';
                        this.cont_status.apply.img = '/common/img/member/+02.png';
                        this.cont_status.apply.info = '<span style="color: #e85252">会员申请</span> 审核失败';
                        break;
                    case 8:
                        this.cont_status.apply.color = '#31CB51';
                        this.cont_status.apply.img = '/common/img/member/+03.png';
                        this.cont_status.apply.info = '<span style="color: #31CB51">会员申请</span> 审核通过，您已申请成功';
                        break;
                }
            },
            cert() {
                var self = this;
                ajax.get(CERT_OFCCERTS).then((res) => {
                    if(res.code == 200 && res.data) {
                        if(res.data.type === 1) {
                            self.pickeds = 0;
                            self.certification('cert', res.data);
                        } else if(res.data.type === 2) {
                            self.pickeds = 1;
                            self.certification('inst', res.data);
                        }
                    }
                })
            },
            certification(name, item) {
                var self = this;
                if(name == 'auth') {
                    // 实名认证 -> 人工认证详情
                    ajax.get(CERT_REALNAME_DETAIL).then((res) => {
                        if(res.code == 200 && res.data) {
                            if(res.data.is_authenticated == 2) {
                                self.already.auth_cont = true;
                                if(res.data.operation_status == 1) {
                                    self.status(0);
                                    // this.time('auth_cont');
                                    self.already.auth = false;
                                    self.member.cert.card_id = res.data.card_id;
                                    self.member.cert.name = res.data.name;

                                    if(self.member_set_type.indexOf('UG') >= 0) {
                                        self.already.cert = true;
                                        self.cert();
                                    } else {
                                        self.already.cert = false;
                                        self.already.apply = true;
                                        self.certification('apply', '');
                                    }

                                } else if(res.data.operation_status == 3) {
                                    self.status(1);
                                    // this.time('auth_cont');
                                    self.member.auth.name = res.data.name;
                                    self.member.auth.card_id = res.data.card_id;
                                    self.member.auth.card_front = res.data.card_front;
                                    self.member.auth.card_back = res.data.card_back;
                                    self.member.auth.weid = res.data.weid;
                                    $("#auth_sub").hide().siblings().show();

                                } else if(res.data.operation_status == 2) {
                                    self.status(2);
                                    // this.time('auth_cont');
                                }

                            } else {
                                self.already.auth_cont = false;
                                self.member.cert.card_id = res.data.card_id;
                                self.member.cert.name = res.data.name;
                            }

                        }

                    });

                } else if(name == 'cert') {
                    // 官方认证 -> 个人认证详情
                    if(item.is_authenticated == 2) {
                        self.already.cert_cont = true;
                        if(item.operation_status == 3 && item.is_done == 2) {
                            self.status(4);
                            // this.time('cert_cont');
                            $("#cert_sub").hide().siblings().show();
                            self.member.cert._method = 'put';
                            self.member.cert.cert_info = item.cert_info;
                            self.member.cert.per_cert_imgs = item.per_cert_imgs;

                        } else if(item.is_done == 1) {
                            self.status(3);
                            // this.time('cert_cont');
                            self.already.cert = false;
                            self.already.apply = true;

                            self.certification('apply', '');
                        }

                    } else {
                        self.already.cert_cont = false;

                    }

                } else if(name == 'inst') {
                    // 官方认证 -> 机构认证详情
                    console.log(this.pickeds);
                    if(item.is_authenticated == 2) {
                        self.already.cert_cont = true;
                        if(item.operation_status == 3 && item.is_done == 2) {
                            self.status(4);
                            // this.time('cert_cont');
                            $("#inst_sub").hide().siblings().show();
                            self.member.inst._method = 'put';
                            self.member.inst.org_name = item.org_name;
                            self.member.inst.org_license_image = item.org_license_image;
                            self.member.inst.org_cert_number = item.org_cert_number;
                            self.member.inst.org_scope_common = item.org_scope_common;
                            self.member.inst.org_scope_front = item.org_scope_front;
                            self.member.inst.org_type = item.org_type;
                            self.member.inst.org_setup_date = item.org_setup_date;
                            self.member.inst.org_auth_imgs = item.org_auth_imgs;
                            self.member.inst.org_contact_people = item.org_contact_people;
                            self.member.inst.org_contact_phone = item.org_contact_phone;
                            self.member.inst.org_address = item.org_address;
                            self.member.inst.cert_info = item.cert_info;
                            self.member.inst.org_cert_imgs = item.org_cert_imgs;

                        } else if(item.is_done == 1) {
                            self.status(3);
                            // this.time('cert_cont');
                            self.already.cert = false;
                            self.already.apply = true;

                            self.certification('apply', '');

                        }

                    } else {
                        self.already.cert_cont = false;

                    }

                } else if(name == 'apply') {
                    self.process_filters('apply');
                    // 会员申请 -> 会员详情
                    ajax.get(MEMBER_APPLY).then((res) => {
                        if(res.code === 200 && res.data) {
                            self.already.apply_cont = true;
                            if(res.data.state == 1) {
                                self.process_filters('first');
                                self.status(6);
                                // this.time('apply_cont');
                                self.already.apply = false;
                                console.log("会员初审", res.data)
                                if(    self.member_set_type.indexOf('UA') >= 0
                                    && self.member_set_type.indexOf('UG') >= 0
                                    && this.pages_page_info.isUA == true
                                    && this.pages_page_info.isUG == true) {
                                    window.location.href = "/application";

                                } else if(self.member_set_type.indexOf('UA') >= 0
                                    && self.member_set_type.indexOf('UG') < 0
                                    && this.pages_page_info.isUA == true) {
                                    window.location.href = "/application";

                                } else if(self.member_set_type.indexOf('UA') < 0
                                    && self.member_set_type.indexOf('UG') >= 0
                                    && this.pages_page_info.isUG == true) {
                                    window.location.href = "/application";

                                }
                            } else

                            if(res.data.state == 2) {
                                self.process_filters('money');
                            } else

                            if(res.data.state == 3) {
                                self.process_filters('second');
                            } else

                            if(res.data.state == 4) {
                                self.process_filters('member');
                            }
                        }
                    })

                }

            },
            process_filters(name) {
                var self = this;
                self.process.map(e => (e.name == name) ? (e.state = true, e) : e);
            },
            levels_list: function(item, index){
                if(item.open_type == 2) {
                    layer.msg(item.level_name+"职位不可选", { time: 2500 });
                    return false;
                } else {
                    this.member_position = item;
                    this.member_levels.type_active = index;
                    this.member.apply.plat_member_level_id = item.mid;
                }
            },
            cert_tab(index) {
                this.cert_num = index;
            },
            member_setting() {
                ajax.get(MEMBER_SETTING).then((body) => {
                    this.member_set_type = body.data.condition;
                    console.log("member_set_type:", this.member_set_type);
                });
            },
            auth_certification() {
                var self = this;
                ajax.get(PAGES_PAGE_INFO).then((res) => {
                    var result = res.data;
                    this.pages_page_info = res.data;
                    console.log("auth_cert:", result);

                    if(result.isUA == false && self.member_set_type.indexOf('UA') >= 0) {
                        console.log("开始实名认证");
                        self.already.auth = true;
                        self.certification('auth', '');
                    } else
                    
                    if(result.isUG == false && self.member_set_type.indexOf('UG') >= 0) {
                        if(result.isUA == true) {
                            self.already.auth_cont = true;
                            self.status(2);
                            // this.time('auth_cont');
                        }
                        console.log("开始官方认证");
                        self.already.cert = true;
                        self.cert();
                    } else
                    
                    if(result.isUM == false) {
                        if(result.isUA == true) {
                            self.already.auth_cont = true;
                            self.status(2);
                            // this.time('auth_cont');
                        }
                        if(result.isUG == true) {
                            self.already.cert_cont = true;
                            self.status(5);
                            // this.time('cert_cont');
                        }
                        console.log("开始会员申请");
                        self.already.apply = true;
                        self.certification('apply', '');
                        
                    } else {
                        window.location.href = '/application';
                    }
                    $(".already").hide();
                });
            },
            art_auth(name) {
                console.log(name);
                var self = this;
                if(name === 'auth') {
                    if(!this.isCardNo(this.member.auth.card_id)) {
                        layer.msg("身份证号码不合法，请重新输入...", { time: 2500 });
                        return false;
                    }

                    if(    !this.member.auth.name
                        || !this.member.auth.card_id
                        || !this.member.auth.card_front
                        || !this.member.auth.card_back) {
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_REALNAME, this.member[name]).then((res) => {
                        if(res.code === 200) {
                            this.certification(name, '');
                        }
                    });
                } else if(name === 'Uauth') {                    
                    if(!this.isCardNo(this.member.auth.card_id)) {
                        layer.msg("身份证号码不合法，请重新输入...", { time: 2500 });
                        return false;
                    }

                    if(    !this.member.auth.name
                        || !this.member.auth.card_id
                        || !this.member.auth.card_front
                        || !this.member.auth.card_back) {
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_REALNAME_UPDATE, this.member.auth).then((res) => {
                        if(res.code === 200) {
                            this.certification("auth", '');
                        }
                    });
                } else if(name === 'cert') {
                    if(!this.isCardNo(this.member.cert.card_id)) {
                        layer.msg("身份证号码不合法，请重新输入...", { time: 2500 });
                        return false;
                    }

                    if(    !this.member.cert.name
                        || !this.member.cert.card_id
                        || !this.member.cert.cert_info
                        || !this.member.cert.per_cert_imgs){
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_OFCCERTS, this.member[name]).then((res) => {
                        if(res.code === 200) {
                            this.cert();
                        }
                    });
                }  else if(name === 'Ucert') {
                    if(!this.isCardNo(this.member.cert.card_id)) {
                        layer.msg("身份证号码不合法，请重新输入...", { time: 2500 });
                        return false;
                    }

                    if(    !this.member.cert.name
                        || !this.member.cert.card_id
                        || !this.member.cert.cert_info
                        || !this.member.cert.per_cert_imgs){
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_OFCCERTS, this.member.cert).then((res) => {
                        if(res.code === 200) {
                            this.cert();
                        }
                    });
                } else if(name === 'inst') {
                    console.log(this.member[name]);
                    if(    !this.member.inst.org_name
                        || !this.member.inst.org_license_image
                        || !this.member.inst.org_cert_number
                        || !this.member.inst.org_scope_common
                        || !this.member.inst.org_scope_front
                        || !this.member.inst.org_type
                        || !this.member.inst.org_setup_date
                        || !this.member.inst.org_auth_imgs
                        || !this.member.inst.org_contact_people
                        || !this.member.inst.org_contact_phone
                        || !this.member.inst.org_address
                        || !this.member.inst.cert_info
                        || !this.member.inst.org_cert_imgs) {
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    if(!self.phone(this.member.inst.org_contact_phone)) {
                        layer.msg("请输入正确的手机号码后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_OFCCERTS, this.member.inst).then((res) => {
                        if(res.code === 200) {
                            this.cert();
                        }
                    });

                }  else if(name === 'Uinst') {
                    console.log(this.member[name]);
                    if(    !this.member.inst.org_name
                        || !this.member.inst.org_license_image
                        || !this.member.inst.org_cert_number
                        || !this.member.inst.org_scope_common
                        || !this.member.inst.org_scope_front
                        || !this.member.inst.org_type
                        || !this.member.inst.org_setup_date
                        || !this.member.inst.org_auth_imgs
                        || !this.member.inst.org_contact_people
                        || !this.member.inst.org_contact_phone
                        || !this.member.inst.org_address
                        || !this.member.inst.cert_info
                        || !this.member.inst.org_cert_imgs) {
                        layer.msg("请完善信息后重新提交！", { time: 2500 });
                        return false;
                    }

                    if(!self.phone(this.member.inst.org_contact_phone)) {
                        layer.msg("请输入正确的手机号码后重新提交！", { time: 2500 });
                        return false;
                    }

                    ajax.post(CERT_OFCCERTS, this.member.inst).then((res) => {
                        if(res.code === 200) {
                            this.cert();
                        }
                    });

                } else if(name === 'apply') {
                    console.log(this.member[name]);
                    if(this.member[name].is_agree_terms) {
                        this.member[name].is_agree_terms = 1;
                    } else {
                        layer.msg("请先阅读规范、章程条款", { time: 2500 });
                        return false;
                    }

                    if( !this.member[name].plat_member_level_id
                        || !this.member[name].plat_member_address
                        || !this.member[name].plat_member_application
                        || !this.member[name].plat_member_contacts
                        || !this.member[name].plat_member_tel
                    ) {
                        layer.msg("请完善信息后重新提交", { time: 2500 });
                        return false;
                    }

                    ajax.post(MEMBER_APPLY, this.member[name]).then((res) => {
                        if(res.code === 200) {
                            this.certification("apply", '');
                        }
                    });

                }
            },
            codes(phone) {
                var self = this;
                var seconds = 60, count = false;
                if(!self.phone(phone)) {
                    layer.msg("手机号码错误", { time: 2500 });
                    return false;
                }

                count = setInterval(function(){
                    if (seconds > 0){
                        seconds -= 1;
                        self.get_card = "剩余"+ seconds + "秒";
                    } else {
                        self.get_card = "重新获取验证码";
                        seconds = 60;
                        clearInterval(count);
                    }
                }, 1000);
                
                ajax.post(CODES, {phone: phone}).then((res) => {
                    self.get_card_state = true;
                    layer.msg("手机已经发送", { time: 2500 });
                })
            },
            login(phone, code) {
                var self = this;
                if(self.phone(phone) && code.length == 6 && self.get_card_state) {
                    ajax.post(LOGIN, {phone: phone, code: code}).then((res) => {
                        if(res.code != -200) {
                            $app.set_login_data(res);
                            self.already.login = false;
                            setTimeout(function(){
                                layer.msg("登录成功", { time: 2500 });
                            });
                            self.auth_certification();
                        } else {
                            clearInterval(count);
                            layer.msg(data.message, { time: 2500 });
                            self.get_card = "重新获取验证码";
                        }
                        
                    })
                } else {
                    if(!self.phone(phone)) {
                        layer.msg("手机号码错误", { time: 2500 });
                        return false;
                    }
                    if(code.length != 6 || !self.get_card_state) {
                        layer.msg("手机验证码错误", { time: 2500 });
                        return;
                    }
                }
            },
            InitQiNiv(name, file_name) {
                var self = this;
                var input = $("#"+file_name);
                var formData = new FormData();
                formData.append("file", input[0].firstChild.files[0]);

                ajax.post('file/uploadfile', formData).then((res)=>{
                    if(res.code == 200) {
                        var result = res.data;
                        if(name === 'auth') {
                            self.member.auth[file_name] = result.key;
                            console.log(1, file_name, self.member, self.member.auth[file_name]);
                        } else if(name === 'cert') {
                            self.member.cert[file_name] = result.key;
                            console.log(2, file_name, self.member, self.member.cert[file_name]);
                        } else if(name === 'inst'){
                            self.member.inst[file_name] = result.key;
                            console.log(3, file_name, self.member, self.member.inst[file_name]);
                        } else if(name === 'apply') {
                            self.member.apply[file_name] = result.key;
                            console.log(4, file_name, self.member, self.member.apply[file_name]);
                        }
                    }
                })
            },
            suffix(name) {
                var filename = name;  
                var index1 = filename.lastIndexOf(".");
                var index2 = filename.length;
                var suffix = filename.substring(index1 + 1, index2);
                if(['doc','docx','pdf'].indexOf(suffix) >= 0) {
                    return suffix = '/common/img/doxc.png';
                }
            },
            set_img: (url, init, w, h, mode) => {
                if (url != '' && url != null && url != undefined) {
                    if (url.indexOf('http') === -1 && url.indexOf('common') === -1) {
                        return mode != undefined ? ApiMaterPlatQiniuDomain + url + '?imageView2/' + mode + '/w/' + w + '/h/' + h
                                : ApiMaterPlatQiniuDomain + url + '?imageView2/3/w/' + w + '/h/' + h;
                    } else {
                        return url;
                    }
                } else {
                    return init;
                }
            },
            setBg(url, init) {
                if (url) {
                    var filename = url;  
                    var index1 = filename.lastIndexOf(".");
                    var index2 = filename.length;
                    var suffix = filename.substring(index1 + 1, index2);
                    if(['doc','docx','pdf', 'txt'].indexOf(suffix) >= 0) {
                        return suffix = '/common/img/doxc.png';
                    } else {
                        return ApiMaterPlatQiniuDomain + url;
                    }
                } else {
                    return init;
                }
            },
            time(name) {
                setTimeout(function () {
                    $("#"+ name).slideUp();
                }, 3500);
            },
            isCardNo(card) {
                var objCard = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                return objCard.test(card);
            },
            phone: (phone) => new RegExp(/^1[3|4|5|6|7|8|9][0-9]{9}$/).test(phone),
            search: (key) => window.location.href = window.location.protocol + '//' + window.location.host + '/so?q=' + key,
            simple_null: (data) => data != null && data != '' && data != undefined ? false : true,
            check: (domain, url) => url != null && url != '' ? url : '/' + domain,
        },
        watch:{
            pickeds(curVal,oldVal){
                console.log(curVal,oldVal);
                this.pickeds = curVal;

            }
        },
        filters: {
            fixed_len: (value, len) => value.length > len ? value.substr(0, len) : value,
                    cut: (value, len) => value.length > len ? value.substr(0, len) + '...' : value,
                    show_date: (value) => value.getFullYear() + '-' + (value.getMonth() + 1) + '-' + value.getDate(),
                    format_date: (value) => {
                var res = value.split('-').reduce((res, e, i) => res += e.length === 1? '0' + e + '-' : e + '-', '');
                return res.substr(0, res.length - 1);
            }
        }
    })
</script>
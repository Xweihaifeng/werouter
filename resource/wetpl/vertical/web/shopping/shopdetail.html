<!DOCTYPE html>
<html>
<head lang="en">
    <title></title>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="shortcut icon" id="favicon" href="" />
    <link rel="stylesheet" href="/common/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/common/layui/css/layui.css" />
    <link rel="stylesheet" href="{{PATH_TML}}css/modal_login.css" />
    <link rel="stylesheet" href="{{PATH_TML}}css/normalize.css" />
    <link rel="stylesheet" href="/common/magazine/css/iview.css">
    <link rel="stylesheet" href="{{PATH_TML}}css/wepage.css" />
    <script src="/common/js/jquery-3.2.1.min.js"></script>
    <script src="/common/public/js/app.js"></script>
    <script src="/common/iview/vue.min.js"></script>
    <script src="/common/iview/axios.min.js"></script>
    <script src="/common/iview/libs/util.js"></script>
    <script src="/common/iview/libs/filter.js"></script>
    <script src="/common/public/js/model/ver_ajax.js"></script>
    <script src="/common/layui/layui.js"></script>
    <script src="{{PATH_CONFIG}}"></script>
    <script src="{{PATH_TML}}js/modal_login.js"></script>
    <script src="/common/magazine/js/iview.min.js"></script>
    <link rel="stylesheet" href="/common/jquery.animsition/css/animsition.min.css">
    <script src="/common/jquery.animsition/js/jquery.animsition.min.js"></script>

    <script type="text/javascript" src="/resource/wetpl/vertical/web/shopping/js/jquery.qrcode.min.js"></script>
    <!--放大镜开始-->
    <script type="text/javascript" src="/resource/wetpl/vertical/web/shopping/js/jquery.jqzoom.min.js"></script>
    <script type="text/javascript" src="/resource/wetpl/vertical/web/shopping/js/focusimg.js"></script>
    <!--放大镜结束-->

    <!--详情页样式开始-->
    <link rel="stylesheet" href="/resource/wetpl/default/web/css/shopping.css">
    <link rel="stylesheet" href="{{PATH_TML}}shopping/css/shopdetail.css" />
    <script type="text/javascript" src="/resource/wetpl/vertical/web/shopping/js/shopdetail.js"></script>
    <script type="text/javascript">
        var APP_ROOT = '';
        var LOADER_IMG = 'https://kezunping.wezchina.com/app/Tpl/wezchina/images/lazy_loading.gif';
        var ERROR_IMG = 'https://kezunping.wezchina.com/app/Tpl/wezchina/images/image_err.gif';
        var send_span = 2000;
        var __HASH_KEY__ = "ATLQFaCNiLUdZRWiSAHphrdhfNiWlobYEyehjcxqbyZvJXKOQe";
    </script>
    <!--详情页样式结束-->
</head>
<body>

<style>
    #main{
        width: 1200px;
        height: auto;
        margin: 0 auto;
        background: #fff;
    }
    .qr_code_icon{
        position: relative;
        top: -32px;
        left: 14px;
        float: right;
        width: 24px;
        height: 24px;
        background: url("{{PATH_TML}}shopping/img/er.png") no-repeat;
        cursor: pointer;
    }
    #shop_code{
        width: 140px;
        height: 142px;
        position: absolute;
        top: 67px;
        left: -115px;
        border: 1px solid #dfdfdf;
        display: none;
        background: #fff;
    }
    #shop_code canvas{
        margin: 15px 15px;
    }
    .qr_code_icon2{
        position: relative;
        top:0;
        right: 0;
        float: right;
        width: 24px;
        height: 24px;
        background: url("{{PATH_TML}}shopping/img/er.png") no-repeat;
        cursor: pointer;
    }
    #shop_code2{
        width: 140px;
        height: 142px;
        position: absolute;
        top: 67px;
        left: -115px;
        border: 1px solid #dfdfdf;
        display: none;
        background: #fff;
    }
    #shop_code2 canvas{
        margin: 15px 15px;
    }
</style>


<div class="modal_login" id="modal_login"></div>
<div id="wepage">
    <div id="header">
        <div>
            <div id="topline">
                <a href="/"><img src="/common/img/new/logo-wepage.png" alt=""/></a>
                <a :href="user" @click="login(1)"><p><img id="avatar" :src="setImg(avatar ,'/common/img/new/my.png', 100, 100)" alt=""/>{{userCenter}}</p></a>
            </div>
        </div>
        <div id="userinfo" :style="{'background': 'url(' + setBg(pages_info.plats_domian.background, '/common/img/new/wepage.png') + ') no-repeat center','background-size': 'cover'}">
            <div>
                <a :href="'/' + pages_info.plats_domian.domain"><img class="avatar1" :src="setImg(brand(pages_info.plats_user.avatar) ,'/common/img/new/avatar.png', 100, 100)" alt=""/></a>
                <p>
                    <span>
                        {{pages_info.plats_user.real_name + '的微主页' | isBrand('user')}}
                        <img :src="imgState('/common/img/new/member.png', '/common/img/new/memberoff.png', pages_info.plats_user_cert.is_authenticated == 1)" alt=""/>
                        <img :src="imgState('/common/img/new/care.png', '/common/img/new/careoff.png', info.if_follow == 1 ? true : false)" alt="" @click="login(0)"/>
                    </span>
                    <span>{{pages_info.plats_user.motto | isBrand('motto')}}</span>
                </p>
            </div>
        </div>
        <div id="menu">
            <ul>
                <li><a :href="'/' + pages_info.plats_domian.domain"><img id="plats-user" :src="setImg(brand(pages_info.plats_user.avatar) ,'/common/img/new/avatar.png', 45, 45)" alt=""></a></li>
                <li v-for="(e, i) in menu.list" @click="style(menu, i, true)" :class="{'underline': i === menu.flag}">{{e.name}}</li>
                <li id="center"><a :href="user" @click="login(1)"><p><img :src="setImg(avatar ,'/common/img/new/my.png', 25, 25)" alt=""/>{{userCenter}}</p></a></li>
            </ul>
        </div>
    </div>
    <div id="container">
        <div id="main">
            <ul id="list">

                <!--商品详情页开始-->
                <div class="user_info_left">
                    <span></span>
                    <div class = "qr_code_icon" @mouseenter="qrcode">
                          <div id="shop_code"></div>
                    </div>
                    <div class="westoreWarp">
                        <div class="pro_deta_top clearfix">
                            <div class="pro_deta_imgs">
                                <div id="preview" class="spec-preview">
                                    <span class="jqzoom" >
                                        <img :jqimg="'http://images.wezchina.com/' + shop_info.cover" :src="'http://images.wezchina.com/' + shop_info.cover" alt="">
                                    </span>
                                </div>
                                <!--缩图开始-->
                                <div class="spec-scroll">
                                    <a class="prev" @click="image_click('L')">&lt;</a>
                                    <a class="next"  @click="image_click('R')">&gt;</a>
                                    <div class="items">
                                        <ul id="items_son">
                                            <li>
                                                <img onmousemove="preview(this);" :bimg="'http://images.wezchina.com/' + shop_info.cover" :src="'http://images.wezchina.com/' + shop_info.cover" alt="">
                                            </li>
                                            <li v-for="item in shop_image_list">
                                                <img onmousemove="preview(this);" :bimg="'http://images.wezchina.com/' + item" :src=" 'http://images.wezchina.com/' + item" alt="">
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <!--缩图结束-->
                            </div>
                            <div class="pro_deta_info">
                                <form  method="get">
                                    <h2 class="tit" title="shop_info.title" v-html="shop_info.title"></h2>
                                    <p class="brief" title="shop_info.summary" v-html="shop_info.summary"></p>
                                    <div class="price">
                                        <b>价格</b>
                                        <span><em>￥</em> {{shop_info.price}} </span>
                                        <b>市场价 ￥<i v-html="shop_info.marketprice"></i></b>
                                    </div>
                                    <div class="state">
                                        <span class="l"><i>已售 </i><em v-html="shop_info.sales_num"></em></span>
                                        <span class="r"><i>收藏 </i><em id="collectnum" v-html="shop_info.collections"></em></span>
                                    </div>
                                    <div class="control-group small-control-group clearfix" style="margin-top:10px;display:none">
                                        <label class="control-label" style="text-align: left;font-size: 14px;width: 38px;color: #999;    overflow: hidden;">配送至：</label>
                                        <div class="control-text">
                                            <select name="province" id="province" class="ui-select field_select small">
                                                <option value="" rel="0">请选择省份</option>
                                            </select>
                                            <select name="city" id="city" class="ui-select field_select small">
                                                <option value="" rel="0">请选择城市</option>
                                            </select>
                                        </div>
                                        <div class="blank0"></div>
                                    </div>
                                    <div class="key">
                                        <div class="amount">
                                            <span class="tb-l">数量</span>
                                            <span class="tb-amount-widget">
                                                <span class="mui-amount-increase" @click="num_click('minus')">-</span>
                                                <input type="text" class="tb-text mui-amount-input" id="add_number" value="1" maxlength="100" title="请输入购买量" name="num" @blur="num_click('num')">
                                                <span class="mui-amount-decrease" @click="num_click('add')">+</span>
                                                </span>
                                            <em class="tb-hidden" style="display: inline;">库存<span class = "num_kc" v-html="shop_info.stock"></span>件</em>
                                        </div>
                                        <p>
                                            <button class="buy_btn" type="button" id="" @click="buy">立即购买</button>
                                            <!--<a href="javascript:void(0);" class="collect_btn collect-btn-click" data-tag="on" >立即收藏</a>''+-->
                                            <a href="javascript:void(0);" class="add_to_cart" data-tag="on" @click="add_buycar">加入购物车</a>
                                            <a href="javascript:void(0);" class="add_to_collect" data-tag="on" @click="collect_select">点击收藏</a>
                                        </p>
                                    </div>

                                </form>
                            </div>

                        </div>
                        <div class="pro_deta_com" id = "goods_detail">
                            <div class="pro_deta_tab" >
                                <a href="#goods_detail" class="active pro_date_tit2" @click="shop_click(0)" href="javascript:void(0)">商品详情</a>
                                <a href="#goods_rule" class="pro_date_tit" @click="shop_click(1)" href="javascript:void(0)">购买须知</a>
                                <button class="buy_btn" type="button" id="buy" @click="buy">立即购买</button>
                                <div class = "qr_code_icon2" @mouseenter="qrcode2">
                                    <div id="shop_code2"></div>
                                </div>
                            </div>
                            <div class="pro_det">
                                <p>
                                    <p>
                                       <span style="color:#666666;font-family:Arial, &quot;font-size:16px;background-color:#FFFFFF;" v-html="shop_info.content"></span>
                                    </p>
                                </p>
                            </div>

                            <div class="pro_need_kown">
                                <h2 class="pro_det_tit" id="goods_rule">购买须知</h2>
                                <div class="info">
                                    <p>
                                        <span style="color:#666666;font-size:16px;background-color:#FFFFFF;" v-html="shop_info.note"></span>
                                    </p>
                                </div>
                            </div>

                            <div class="shangpingpingjia">
                                <h2 class="pro_det_tit" id="pro_mess">精选评价</h2>

                                <ul class="pingjianeirong" id="commont">
                                    <li class="supporter" v-for="item in commont">
                                        <div class="supporter_img ">
                                            <img class="img-circle" :src="'http://images.wezchina.com/' + item.avatar">
                                        </div>
                                        <div class="supporter_user">
                                            <span class="supporter_user_log"></span>
                                            <p class="supporter_user_mid m0"> </p>
                                            <span class="supporter_user_sm"></span>
                                            <div class="supporter_user_color" v-html="item.created_at"></div>
                                            <div style="display: inline-block;"></div>
                                            <div class="supporter_user_liuyan" style="width: 743px;min-height: 44px;line-height: 44px" v-html="item.content"></div>
                                        </div>
                                    </li>
                                    <!--分页-->
                                    <!--<div class="commentpage" style="text-align: center;">-->
                                        <Page :total="total" :current="page" :page-size="limit" @on-change="change" v-if="total > limit" id="ivu-page"></Page>
                                    <!--</div>-->
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
                <!--商品详情页结束-->

            </ul>
            <ul id="info">
                <li id="maininfo">
                    <span id="userhead" :style="{'background': 'url(' + setBg(pages_info.plats_domian.background_user, '/common/img/new/bg.png') + ') no-repeat center', 'background-size': '100% 100%'}"></span>
                    <a :href="'/' + pages_info.plats_domian.domain"><img :src="setImg(pages_info.plats_user.avatar ,'/common/img/new/avatar.png', 90, 90)" alt=""/></a>
                    <span id="username">{{pages_info.plats_user_cert.name || pages_info.plats_user.real_name}}</span>
                    <ul>
                        <a :href="'/' + pages_info.plats_domian.domain + '/article'">
                            <li>
                                <span>{{info.article_count}}</span>
                                <span>文章</span>
                            </li>
                        </a>
                        <a :href="'/' + pages_info.plats_domian.domain + '/project'">
                            <li>
                                <span>{{info.project_count}}</span>
                                <span>项目</span>
                            </li>
                        </a>
                        <a :href="'/' + pages_info.plats_domian.domain + '/activity'">
                            <li>
                                <span>{{info.activity_count}}</span>
                                <span>活动</span>
                            </li>
                        </a>
                    </ul>
                </li>
                <li id="address">
                    <ul>
                        <li>
                            <span>
                                <i :style="fontColor">官方认证</i>
                                <img :src="imgState('/common/img/new/offical.png', '/common/img/new/officaloff.png', pages_info.plats_user_cert.is_authenticated == 1)" alt="" width="76" height="26"/>
                                <img :src="imgState('/common/img/new/cert.png', '/common/img/new/certoff.png', pages_info.plats_user_auth.is_authenticated == 1)" alt="" width="32" height="28"/>
                                <img src="/common/img/new/message.png" alt="" width="60" height="24"/>
                            </span>
                            <span>{{pages_info.plats_user_cert.cert_info}}</span>
                        </li>
                        <li>
                            <img src="/common/img/new/address.png" alt="" width="17" height="22"/>
                            <span>{{area(pages_info.plats_user.province.name, pages_info.plats_user.area.name)}}</span>
                        </li>
                        <li>
                            <img src="/common/img/new/sign.png" alt="" width="17" height="18"/>
                            <span>{{pages_info.plats_user.motto}}</span>
                        </li>
                        <li>
                            <img :src="setImg(pages_info.plats_user_qrcode, '/common/img/new/qrcode.png', 140, 140)" alt="" width="140" height="140"/>
                            <p>
                                <span>微信扫描二维码</span>
                                <span>分享给好友</span>
                            </p>
                        </li>
                    </ul>
                </li>
                <li id="friends">
                    <ul>
                        <li>
                            <p @mouseenter="select('fans')" :class="{'friends': active == 'fans'}">我的粉丝({{info.fnums}})</p>
                            <p @mouseenter="select('friends')" :class="{'friends': active == 'friends'}">我的关注({{info.gnums}})</p>
                        </li>
                        <li v-show="active == 'fans'">
                            <a v-for="e in info.flist" :href="'/' + e.domain" :title="e.nickname">
                                <img class="care" :src="setImg(e.avatar, '/common/img/new/1.png', 54, 54)" alt="" width="54" height="54"/>
                            </a>
                        </li>
                        <li v-show="active == 'friends'">
                            <a v-for="e in info.glist" :href="'/' + e.domain" :title="e.nickname">
                                <img class="care" :src="setImg(e.avatar, '/common/img/new/1.png', 54, 54)" alt="" width="54" height="54"/>
                            </a>
                        </li>
                        <li>
                            查看更多>>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div id="bottom1">
        <footer>
            <div class="footer-nav">
                <a href="javascript:void(0)">咨询与建议</a>
                <a href="javascript:void(0)">站点地图</a>
                <a id="contact" href="/org/lxwm">联系我们</a>
            </div>
            <div class="copyright" v-html="plats_info.copyright"></div>
            <div class="_ideConac">
                <img src="/common/img/gabeian.png" width="60" height="60">
            </div>
        </footer>
    </div>
</div>

<script>
        $(function() {
            $(".animsition").animsition({
                inClass               :   'fade-in',
                outClass              :   'fade-out',
                inDuration            :    300,
                outDuration           :    300,
                linkElement           :   '.animsition-link',
                // e.g. linkElement   :   'a:not([target="_blank"]):not([href^=#])'
                loading               :    true,
                loadingParentElement  :   'body', //animsition wrapper element
                loadingClass          :   'animsition-loading',
                unSupportCss          : [ 'animation-duration',
                    '-webkit-animation-duration',
                    '-o-animation-duration'
                ],
                //"unSupportCss" option allows you to disable the "animsition" in case the css property in the array is not supported by your browser.
                //The default setting is to disable the "animsition" in a browser that does not support "animation-duration".
                overlay               :   false,
                overlayClass          :   'animsition-overlay-slide',
                overlayParentElement  :   'body'
            });
        });
        var lineChart,lineTheme,xTitle,newlyAdded,Active,mapChart,mapData,requestUrl = apiUrl + 'circel/wcurve?domain=' + pages_info.plats_domian.domain;
        $(".y").text('数据来源：' + plats_info.title);
        var wefriends = function(nums, res) {
            var n = parseInt(nums);
            nums = nums + '';
            var len = nums.length;
            if (len == 0) {
                $(".red").html(res.reverse().join(''));
            } else {
                res.push(`<li>${n % 10}</li>`);
                wefriends(nums.substr(0, len - 1), res);
            }
        }
        var getLine = function(data) {
            var m = 1; //倍率
            var n = 10; //时间
            var i = 0;
            var nums = data.wnums;
            var computeTime = function(sum, time) {
                if (sum > (time * 1000 / n)) {
                    m = parseInt(sum / (time * 1000 / n));
                }
            }
            var numbers = setInterval(function(){
                if (i < nums) {
                    wefriends(i, []);
                    i += m;
                } else {
                    wefriends(nums, []);
                    clearInterval(numbers);
                }
            }, n);

            computeTime(nums, 4);

            var curve = data.wcurve;
            var spread = data.wspread;
            var slen = wepage.checkRed(spread).length;
            var arr = [0,0,0,0,0,0,0,0,0,0,0,0];
            // 折线图
            lineTheme = {color:['#C23531','#17C295']};
            lineChart = echarts.init(document.getElementById('curve_count'), lineTheme);
            xTitle = eval('["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"]');
            newlyAdded = wepage.genArr(curve, arr);
            Active = wepage.genArr(curve, arr);
            // 地图
            mapChart = echarts.init(document.getElementById('lanuch_main'));
            mapData = wepage.genMap(spread);
            if (slen == 0) {
                $("#red").html("<span class='rcmd'></span><span style='color: #333;'>看哈，Ta成为网红潜力很大，大家帮Ta加加油！</span>")
            } else if (slen < 34 && slen > 0) {
                $("#red").html("<span class='rcmd'></span><span style='color: #333;'>Ta已经红遍中国" + slen + "省，是名副其实的小网红！</span>")
            } else if (slen >= 34) {
                $("#red").html("<span class='rcmd'></span><span style='color: #333;'>Ta已经红遍中国，是名副其实的网红！</span>")
            }
            makeChart();
        }

        //info
        new Vue({
            el: "#info",
            data: {
                active: 'fans',
                info: {},
                fontColor: pages_info.plats_user_cert.is_authenticated == 1 ? {color: '#ff9900'} : {color: '#999'}
            },
            created: function(){
                this.wefriends();
            },
            methods: {
                wefriends: function(){
                    axios.get(apiUrl + 'circel/index?domain=' + pages_info.plats_domian.domain, {
                        headers: {'Token': plats_token}
                    }).then(data => {
                        this.info = data.data.data;
                        getLine(this.info);
                    })
                },
                setBg: function(url, init) {
                    if (url != null) {
                        return ApiMaterPlatQiniuDomain + url;
                    } else {
                        return init;
                    }
                },
                setImg: function(url, init, w, h, mode) {
                        if (url != '' && url != null && url != undefined) {
                            if (url.indexOf('http') === -1 && url.indexOf('common') === -1) {
                                return mode != undefined ? ApiMaterPlatQiniuDomain + url + '?imageView2/' + mode + '/w/' + w + '/h/' + h
                                        : ApiMaterPlatQiniuDomain + url + '?imageView2/3/w/' + w + '/h/' + h;
                            } else {
                                return url + '?imageView2/3/w/' + w + '/h/' + h;
                            }
                        } else {
                        return init;
                    }
                },
                imgState: function(on, off, state) {
                    if (state) {
                        return on;
                    } else {
                        return off;
                    }
                },
                area: function(province, area) {
                    if (province != null) {
                        return province + ' ' + area;
                    } else {
                        return '来自火星';
                    }
                },
                select: function(type) {
                    this.active = type;
                }
            }
        })

        //footer
        new Vue({
            el: "#bottom1",
            data: {                
            },
            created: function(){

            }
        })

        var wepage = new Vue({
            el: '#header',
            data: {
                menu: {},
                dataMenu: ['首页', '我的文章', '我的活动', '我的商城', '我的圈子'],
                dynamic: [{id: 1, val: '/article/'}, {id: 3, val: '/activity/'}, {id: 4, val: '/wemall/goods/'}],
                active: 'fans',
                info: {},
                latest: [],
                articles: [],
                activity: [],
                shopping: {},
                shopCate: [],
                pages: {
                    latest: {total: 10, page: 1, limit: 10},
                    articles: {total: 10, page: 1, limit: 10},
                    activity: {total: 10, page: 1, limit: 10},
                    shopping: {total: 1, page: 1, limit: 1},
                    zone: {total: 1, page: 1, limit: 1}
                },
                page: {},
                type: '',
                none: false,
                avatar: '',
                userCenter: '',
                user: 'javascript:void(0)',
                fontColor: pages_info.plats_user_cert.is_authenticated == 1 ? {color: '#ff9900'} : {color: '#999'}
            },
            created: function(){
                this.menu = {list: this.dataMenu.map(e => ({name: e})), flag: -1};  //////////////////////////////
                this.wefriends();
                this.init(window.location.pathname.split('/').pop());                
                this.avatar = docCookies.getItem('token') ? (plats_user_info.avatar ? plats_user_info.avatar : localStorage.getItem('avatar')) : '';
                
                if (!docCookies.getItem('token')) {
                    this.userCenter = '快速登录';
                } else {
                    this.userCenter = '用户中心';
                }

                layui.use('layer', function() {
                    this.layer = layui.layer;
                })

                $("#plats-user").hide();
                $("#center").hide();
                var height = $("#menu").offset().top;
                $(window).scroll(function(){
                    if($(document).scrollTop() >= height){
                        $("#menu").css({position:"fixed",top:0,left:0,zIndex:99});
                        $("#content").css({"padding-top":"55px"});
                        $("#center").show();
                        $("#plats-user").show();                        
                        $("#menu ul li:nth-child(2)").hide();
                    }else{
                        $("#menu").css({position:"relative",zIndex:0});
                        $("#content").css({"padding-top":0});
                        $("#center").hide();
                        $("#plats-user").hide();
                        $("#menu ul li:nth-child(2)").show();
                    }
                })

                $('#favicon').attr('href', ApiMaterPlatQiniuDomain + plats_info.favicon);
                $("title").text(pages_info.plats_show.head_title);
            },
            mounted: function(){
                this.$nextTick(function(){
                    window.onpopstate = function(e) {
                        var curr = window.location.pathname.split('/').pop();
                        var list = ['', 'article', 'activity', 'wemall', 'quan'];
                        var id = list.indexOf(curr);                    
                        if (id != -1) {
                            wepage.menu.flag = id;
                            switch (id) {
                                case 0: wepage.type = 'latest'; wepage.latest == '' ? wepage.none = true : wepage.none = false; break;
                                case 1: wepage.type = 'articles'; wepage.articles == '' ? wepage.none = true : wepage.none = false; break;
                                case 2: wepage.type = 'activity'; wepage.activity == '' ? wepage.none = true : wepage.none = false; break;
                                case 3: wepage.type = 'shopping'; wepage.shopping == '' ? wepage.none = true : wepage.none = false; break;
                                case 4: wepage.type = 'zone'; wepage.none = false; break;
                            }
                        } else {
                            wepage.menu.flag = 0;
                            wepage.type = 'latest'
                        }                        
                    }
                })
            },
            methods: {
                init: function(type){
                    switch (type) {
                        case '': this.type='latest'; this.getLatest(1, 10); this.menu.flag = 0; break;
                        case 'article': this.type='articles'; this.getArtList(1, 10); this.menu.flag = 1; break;
                        case 'activity': this.type='activity'; this.getActList(1, 10); this.menu.flag = 2; break;
                        case 'wemall': this.type='shopping'; this.getShopCate(); this.menu.flag = 3; break;
                        case 'quan': this.type='zone';this.menu.flag = 4; break;
                        default: /*this.type='latest'; this.getLatest(1, 10); this.menu.flag = 0;*/ break;
                    }
                },
                wefriends: function(){
                    axios.get(apiUrl + 'circel/index?domain=' + pages_info.plats_domian.domain, {
                        headers: {'Token': plats_token}
                    }).then(data => {
                        this.info = data.data.data;
                        getLine(this.info);
                    })
                },
                changeArr: function(arr, id, val) {
                    var cnt = 1;
                    return arr.map(x => {
                        if (id == cnt) {
                            cnt++;
                            return parseInt(val);
                        } else {
                            cnt++;
                            return x;
                        }
                    })
                },
                genArr: function(curve, arr) {
                    var res = arr;
                    curve.map(x => res = this.changeArr(res, x.grow_m, x.nums));
                    return res;
                },
                genMap: function(spread) {
                    var res = [];
                    spread.map(x => res.push({"name": x.area_title, "value": x.nums}));
                    return res;
                },
                checkRed: function(spread) {
                    return spread.filter(x => parseInt(x.nums) > 10000);
                },
                follow: function(){
                    $.ajax({
                        url: apiUrl + 'circel/relationship',
                        type: 'POST',
                        headers: {
                            'Token': plats_token
                        },
                        data: {
                            'domain': pages_info.plats_domian.domain,
                            'type': 2
                        },
                        success: function(data){
                            if (data.code == 200) {
                                wepage.info.if_follow = 1;
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg("关注成功", {time: 1500});
                                })
                            } else {
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg(data.message, {time: 1500});
                                })
                            }
                        }
                    })
                },
                cancelFollow: function(){
                    $.ajax({
                        url: apiUrl + 'circel/quxiao',
                        type: 'POST',
                        data: {
                            'domain': pages_info.plats_domian.domain,
                            'type': 2
                        },
                        headers: {
                            'Token': plats_token
                        },
                        success: function(data){
                            if (data.code == 200) {
                                layui.use('layer', function() {
                                    wepage.info.if_follow = 0;
                                    var layer = layui.layer;
                                    layer.msg("取消关注成功", {time: 1500});
                                })
                            } else {
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg(data.message, {time: 1500});
                                })
                            }
                        }
                    })
                },
                getLatest: function(page, limit) {
                    axios.get(apiUrl + 'circel/dynamic?page=' + page + '&limit=10' + '&type=1&dynamic_type=0&domain=' + pages_info.plats_domian.domain).then(data => {                        
                        this.type = 'latest';
                        this.latest = data.data.data.list;
                        this.latest == '' ? wepage.none = true : wepage.none = false;
                    })
                },
                getArtList: function(page, limit) {
                    $.ajax({
                        url: ARTICLE_LIST + '?userId=' + pages_info.plats_domian.plat_user_id + '&page=' + page + '&limit=' + limit,
                        success: function(data){
                            if (data.code == 200){
                                wepage.type = 'articles';
                                wepage.articles = data.data.list;
                                wepage.pages.articles.total = data.data.total;
                                wepage.pages.articles.page = page;
                                wepage.page = wepage.pages.articles;
                                wepage.articles == '' ? wepage.none = true : wepage.none = false;
                            }
                        }
                    })
                },
                getActList: function(page, limit) {
                    $.ajax({
                        url: apiUrl + 'activity/listbyuser',
                        type: 'POST',
                        data: {
                            user_id: pages_info.plats_domian.plat_user_id,
                            status: 2,
                            is_private: 1,
                            page: page,
                            limit: limit
                        },
                        success: function(data){
                            if (data.code == 200){
                                wepage.type = 'activity';
                                wepage.activity = data.data.list;
                                wepage.pages.activity.total = data.data.total;
                                wepage.pages.activity.page = page;
                                wepage.page = wepage.pages.activity;
                                wepage.activity == '' ? wepage.none = true : wepage.none = false;
                            }
                        }
                    })
                },
                getShopCate: function() {
                    axios.get(GOODS_CATES_LIST_USERID + "/" + pages_info.plats_domian.plat_user_id).then(data => {
                        if (Object.keys(data.data.data) != '') {
                            this.shopCate = data.data.data.map(e => (e.shopping = [], e));
                            this.getShopList(this.shopCate, 1, 10);
                        } else {
                            this.type = 'shopping';
                            this.none = true;
                        }
                    })
                },
                getShopList: function(cate, page, limit) {
                    this.type = 'shopping';
                    this.shopCate == '' ? this.none = true : this.none = false;
                    this.shopCate.map(e => {
                        $.ajax({
                            url: GOODS_LISTS_USERANDCATE,
                            type: "POST",
                            data: {
                                userId: e.plat_user_id,
                                cateId: e.weid
                            },
                            success: function(data){
                                e.shopping = data.data.list.map(e => (e.stateBuy = false, e));
                            }                                                            
                        })
                    })
                    // console.log(this.shopCate)
                },
                login: function(type){
                    if (!docCookies.getItem("token")) {
                        $("#modal_login").show();                        
                    } else {
                        if (type == 0) {
                            //1:已关注 0：未关注
                            this.info.if_follow == 1 ? this.cancelFollow() : this.follow();    
                        } else {
                            this.user = '/user';                            
                        }                        
                    }
                },
                change: function(page){
                    $(document).scrollTop(340);
                    switch (this.type) {
                        case 'latest': this.getLatest(page, 10); break;
                        case 'articles': this.getArtList(page, 10); break;
                        case 'activity': this.getActList(page, 10); break;
                    }
                },
                style: function(list, i, jump) {
                    list.flag = i;
                    if (jump) {
                        switch (i) {
                            case 0: window.location.href = '/' + pages_info.plats_domian.domain + '/'; break;
                            case 1: window.location.href = '/' + pages_info.plats_domian.domain + '/article'; break;
                            case 2: window.location.href = '/' + pages_info.plats_domian.domain + '/activity'; break;
                            case 3: window.location.href =  '/' + pages_info.plats_domian.domain + '/wemall'; break;
                            case 4: window.location.href = '/' + pages_info.plats_domian.domain + '/quan'; break;
                        }
                    } else {
                        switch (i) {
                            case 0: this.getLatest(1, 10); this.pages['latest'].page = 1; window.history.pushState(null, null, '/' + pages_info.plats_domian.domain + '/'); break;
                            case 1: this.getArtList(1, 10); this.pages['articles'].page = 1; window.history.pushState(null, null, '/' + pages_info.plats_domian.domain + '/article'); break;
                            case 2: this.getActList(1, 10); this.pages['activity'].page = 1; window.history.pushState(null, null, '/' + pages_info.plats_domian.domain + '/activity'); break;
                            case 3: this.getShopCate(this.shopCate, 1, 10);this.pages['shopping'].page = 1; window.history.pushState(null, null, '/' + pages_info.plats_domian.domain + '/wemall'); break;
                            case 4: wepage.type = 'zone'; wepage.none = false; this.pages['zone'].page = 1; window.history.pushState(null, null, '/' + pages_info.plats_domian.domain + '/quan'); break;
                        }
                    }
                },
                select: function(type) {
                    this.active = type;
                },
                setImg: function(url, init, w, h, mode) {
                        if (url != '' && url != null && url != undefined) {
                            if (url.indexOf('http') === -1 && url.indexOf('common') === -1) {
                                return mode != undefined ? ApiMaterPlatQiniuDomain + url + '?imageView2/' + mode + '/w/' + w + '/h/' + h
                                        : ApiMaterPlatQiniuDomain + url + '?imageView2/3/w/' + w + '/h/' + h;
                            } else {
                                return url + '?imageView2/3/w/' + w + '/h/' + h;
                            }
                        } else {
                        return init;
                    }
                },
                setBg: function(url, init) {
                    if (url != null) {
                        return ApiMaterPlatQiniuDomain + url;
                    } else {
                        return init;
                    }
                },
                imgState: function(on, off, state) {
                    if (state) {
                        return on;
                    } else {
                        return off;
                    }
                },
                area: function(province, area) {
                    if (province != null) {
                        return province + ' ' + area;
                    } else {
                        return '来自火星';
                    }
                },
                brand: function(avatar) {
                    if (pages_info.plats_brand) {
                        if (pages_info.plats_brand.logo != '') {
                            return pages_info.plats_brand.logo;
                        } else {
                            return avatar;
                        }
                    } else {
                        return avatar;
                    }
                },
                buy: function(o, i, state) {                    
                    if (state != 'leave') {
                        o.stateBuy = true;
                    } else {
                        o.stateBuy = false;
                    }                    
                }
            },
            filters: {
                isBrand: function(val, type) {
                    if (pages_info.plats_brand) {
                        switch(type) {
                            case 'user': return pages_info.plats_brand.title; break;
                            case 'motto': return pages_info.plats_brand.slogan; break;
                            default: break;
                        }
                    } else {
                        if (pages_info.plats_domian.domain == 'index' && type == 'user') {
                            return plats_info.plat_name
                        } else {
                            return val;
                        }
                    }
                },
                cut: function(value, len) {
                    return value.length > len ? value.substr(0, len) + '...' : value;
                }
            }
        })
    </script>

<script>

    new Vue({
        el: '#list',
        data: {
           cate_domain : $app.get_router(1), // 分类个性域名
           id_domain:$app.get_router(4),   //商品id
           shop_info:{},                   //商品信息
           shop_image_list:[]  ,             //图片信息
            page:1 ,                          //当前页数
            commont:[],                        //评论内容
            total:0,                            //评论总条数
            limit:3,                             //显示评论数
            collect_id:""                       //收藏id
        },
        mounted: function() {
            var self = this;
            this.$nextTick(()=>{
               // 商品展示
                 this.shop(this.id_domain);
                 // 商品评论
                self.comment();
                self.focusimgfun()
                self.zoomfun();
                this.qrcodefun(this.id_domain);

            });
        },
        created: function(){
            //menu
            layui.use('layer', function() {
                this.layer = layui.layer;
            })

        },
        methods: {
           // 商品详情
            shop(id) {
                ajax.get(GOODS_DETAIL + '/' + id).then((res)=>{
                    if(res.code == 200) {
                        this.shop_info = res.data;
                        var str = this.shop_info.picture;
                        this.shop_image_list = str.split(',');
                        // 商品收藏
                        this.collection(res.data.weid)
                    }
                })
            },
            // 详情点击效果
            shop_click(cate) {
                $(".pro_deta_tab").children("a").eq(cate).addClass("active").siblings().removeClass("active");
            },
            // 图片浏览效果
            image_click(dire) {
                var length
                var Left=$("#items_son").position().left;
                if(dire == "L" ){
                    length=$("#items_son>li").width();
                    if(Left==0){
                        length=0;
                    }
                }else if(dire == "R"){
                    length=-$("#items_son>li").width();
                    if(Left<=length*($("#items_son>li").length-4)){
                        length=0;
                    }
                }
                var left=Left+length;
                console.log(left)
                 $("#items_son").animate({left:left},"slow");

            },
            //商品选择个数
            num_click(dire) {
                var num = $('.mui-amount-input').val();
                if(dire == "minus"){
                    if(num > 1) {
                        num--;
                    }
                    $('.mui-amount-input').val(num);
                }else if(dire == "add"){

                    var kc = parseInt($('.num_kc').text());
                    if(num < kc) {
                        num++;
                    }
                    $('.mui-amount-input').val(num);
                }else if(dire == "num"){
                    var num_input = $(".tb-text").val();
                    var kc = parseInt($('.num_kc').text());
                    if(num_input < kc) {
                        $('.mui-amount-input').val(num_input);
                    } else {
                        $('.mui-amount-input').val(kc);
                    }
                }


            },
            // 立即购买
            buy() {
                var self=this;
                if(docCookies.getItem("token")) {
                    localStorage.setItem("num", $("input[name='num']").val());
                    var obj = {
                        goods_list : [
                            {
                                "goods_id" : self.id_domain,
                                "goods_num": $("input[name='num']").val()
                            }
                        ]
                    };

                    $.ajax({
                        url : apiUrl + 'users/imagecodeid',
                        type : 'get',
                        headers : {
                            'Token': docCookies.getItem("token")
                        },
                        dataType : 'json',
                        success : function (res) {
                            console.log(res);
                            if(res.code === 200){
                                window.localStorage.setItem(res.data,JSON.stringify(obj));
                                // console.log(window.location.protocol + '//' + window.location.host)
                                // console.log("http://cnew.wezchina.com/" + self.cate_domain)
                                window.location.href = window.location.protocol + '//' + window.location.host + '/' + self.cate_domain + "/wemall/order/" + res.data;
                            }
                        }
                    })
                } else {
                    $("#modal_login").show();
                }
            },
            // 加入购物车
            add_buycar() {
                if(!docCookies.getItem("token")) {
                    $("#modal_login").show();
                } else {
                    var weid = window.location.pathname.split("/").pop();
                    var add_number = $("#add_number").val();
                    $.ajax({
                        url: apiUrl + 'cart/store',
                        type: 'post',
                        dataType: 'json',
                        data: {
                            goods_id: weid,
                            goods_num: add_number
                        },
                        headers: {
                            'Token': docCookies.getItem("token"),
                        },
                        success: function(data) {
                            // console.log(data);
                            if(data.code == 200) {
                                console.log(data);

                                $(".add_to_cart").css({
                                    "background": '#d4d4d4',
                                    "cursor": 'default'
                                });
                                $(".add_to_cart").unbind("click");
                                // alert("成功加入购物车")
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg("成功加入购物车", {time: 2500});
                                })
                            } else {
                                // alert("该商品已经加入购物车,请勿重复添加")
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg("该商品已经加入购物车,请勿重复添加", {time: 2500});
                                })

                            }
                        },
                        error: function(xhr) {
                            console.log(xhr);
                        }
                    })
                }
            },
            // 商品评论
            comment() {
                var self=this;
                $.ajax({
                    url: GOODS_COMMENT_LIST + "?limit=" + self.limit + "&page=" + self.page,
                    type: 'post',
                    data: {
                        goods_id: self.id_domain,
                        limit:2,
                        page:self.page
                    },
                    dataType: 'json',
                    headers: {
                        'Token': docCookies.getItem("token")
                    },
                    success: function(data) {

                        if(data.code == 200) {
                            self.total=data.data.total;
                            self.commont=data.data.list;
                        }
                    },
                    error: function(xhr) {
                        console.log(xhr);
                    }
                })
            },
            // 分页
            change(page) {
                var self = this;
                self.page = page;
                comment();
            },
            // 创建focusimg.js元素
            focusimgfun() {
                   console.log(1)
                   var scriptEle = $("<script >< /script>");
                    scriptEle.attr("src", "/common/js/focusimg.js");
                    $("head").append(scriptEle);
               },

            // 放大镜
            zoomfun()  {
                  console.log($(".jqzoom"))
                  $(".jqzoom").jqueryzoom({
                      xzoom: 200, //放大图的宽度(默认是 200)
                      yzoom: 200, //放大图的高度(默认是 200)
                      offset: 10, //离原图的距离(默认是 10)
                      position: "right", //放大图的定位(默认是 "right")
                      preload: 1,
                      magnify: 0.5
                  });
              },
            // 二维码生成
            qrcodefun(id) {
                var localhostPath=window.location.protocol + '//' + window.location.host + '/'
                var qrcode_val = localhostPath + this.user_domain + "/wemall/goods/" + id;
                if ($.support.msie && $.support.version <= 8) {
                    $("#shop_code").qrcode({
                        render: "table",
                        width: 110,
                        height: 110,
                        text: qrcode_val
                    });
                    $("#shop_code2").qrcode({
                        render: "table",
                        width: 110,
                        height: 110,
                        text: qrcode_val
                    });
                } else {
                    jQuery("#shop_code").qrcode({
                        width: 110,
                        height: 110,
                        text: qrcode_val
                    });
                    jQuery("#shop_code2").qrcode({
                        width: 110,
                        height: 110,
                        text: qrcode_val
                    });
                }

            },
            qrcode(){
                $("#shop_code").show();
                $(".qr_code_icon").mouseleave(function(){
                    $("#shop_code").hide();
                })
            },
            qrcode2(){
                $("#shop_code2").show();
                $(".qr_code_icon2").mouseleave(function(){
                    $("#shop_code2").hide();
                })
            },
            // 点击收藏
            add_collection(uid,goods_id){
                var self=this;
                $.ajax({
                    url: apiUrl + 'goods/collection/store',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        goods_id: uid,
                        mall_id: goods_id,
                    },
                    headers: {
                        'Token': docCookies.getItem("token"),
                    },
                    success: function(data) {
                        // console.log(data);
                        if(data.code == 200) {
                            console.log(data);

                            $(".add_to_collect").css({
                                "background": '#d4d4d4',
                            });
                            $(".add_to_collect").html("已收藏");
                               self.collect_id=data.data;
                            layui.use('layer', function() {
                                var layer = layui.layer;
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg("收藏成功", {time: 2500});
                                })
                            })
                        }
                    },
                    error: function(xhr) {
                        console.log(xhr);
                    }
                })
            },
            //取消收藏
            del_collection(id){
                console.log("删除")
                ajax.get('goods/collection/destroy/' + id).then((res)=>{
                    console.log(11111,res.data)
                    if(res.code == 200) {
                              alert(1111)
                            $(".add_to_collect").css({ "background": '#DE3E1E',"cursor": 'default'})
                            this.collect_id="";
                            $(".add_to_collect").html("点击收藏")
                            layui.use('layer', function() {
                                var layer = layui.layer;
                                layui.use('layer', function() {
                                    var layer = layui.layer;
                                    layer.msg("取消收藏成功", {time: 2500});
                                })
                            })

                    }
                })
            },
            //判断是否收藏
            collection(id){
                ajax.get('goods/collection/iscollection/' + id).then((res)=>{
                    if(res.code == 200) {
                        if(res.data!='no'){
                            $(".add_to_collect").css({ "background": '#d4d4d4'})
                            $(".add_to_collect").html("已收藏")
                            this.collect_id=res.data;
                        }
                    }
                })
            },
            // 点击收藏
            collect_select(){
                if(this.collect_id == ""){
                    console.log(plats_user_info)
                    this.add_collection(this.id_domain,this.shop_info.mall_id)
                }else{
                    console.log(this.collect_id)
                     this.del_collection(this.collect_id)
                }
            }
        },

    })
</script>

</body>
</html>